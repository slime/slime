2004-01-22  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* test.sh: Copy the ChangeLog file too.

	* swank-cmucl.lisp: Replace some defmethods with
	defimplementation.

	* swank-allegro.lisp (return-from-frame, restart-name): Implement
	interface (partly).

	* swank-openmcl.lisp (restart-frame, return-from-frame): Remove
	sldb-prefix.

	* swank-backend.lisp (return-from-frame, restart-frame):
	Are now interface functions.

	* slime/swank.asd: Remove dependency on :sb-bsd-sockets.  Is
	already done in swank-sbcl.

	* swank-loader.lisp: Don't reference the swank package at
	read-time.

	* swank.lisp (completions): Never bind *package* to nil.  That's a
	type error in SBCL.
	(swank-debugger-hook): Flush the output streams and be careful
	when accessing *buffer-package*.  
	(create-swank-server): Return the port of the serve socket.

	* swank-lispworks.lisp (interesting-frame-p): Don't print catch
	frames.
	(make-sigint-handler): New function.
	(emacs-connected): Use it.

	* slime.el (slime-lisp-implementation-type): New per connection
	variable.
	(slime-handle-oob): Handle debug-condition event.  Can be signaled
	CMUCL when cannot produce a backtrace.
	(slime-debugging-state): Don't pop up the debugger buffer an
	activate events. Annoying.
	(sldb-break-with-default-debugger): Switch to the output buffer
	before returning to the tty-debugger.
	(sldb-return-from-frame, sldb-restart-frame): Use slime-rex.
	(slime-list-connections, slime-short-state-name): New functions.

2004-01-20  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el (slime-complete-symbol): Insert the completed-prefix
	before deleting the original text to avoid troubles with left
	inserting markers.
	(slime-symbol-start-pos): Skip backward across symbol
	constituents.
	(slime-evaluating-state): [:read-sring] Save the window
	configuration.
	(slime-read-string-state): Don't handle activate events
	(troublesome if, e.g, complete-symbol is used from another
	buffer).  Restore the window configuration.
	(slime-repl-read-string): Goto the end of buffer.
	(slime-debugging-state): [:activate] Display the debugger buffer
	if not visible.
	(slime-to-lisp-filename, slime-from-lisp-filename)
	(slime-translate-to-lisp-filename-function)
	(slime-translate-from-lisp-filename-function, slime-compile-file)
	(slime-goto-location-buffer, slime-ed, slime-load-file): Support
	for remote filename translation (untested).

	* swank.lisp (create-swank-server): Take announce-fn as optional
	argument.

	* swank-allegro.lisp: Replace defmethod with defimplementation.
	(eval-in-frame): Implemented.

2004-01-20  Lasse Rasinen  <lrasinen@iki.fi>

	* slime.el (slime-prin1-to-string): Replacement for
	prin1-to-string that avoids escaping non-ascii characters in a
	way that the CL reader doesn't understand. Allows use of 8-bit
	characters in Lisp expressions with Emacs in unibyte-mode.

2004-01-20  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-eval-print-last-expression): Insert a newline
	before and after the result.
	(slime-easy-menu): Added menu items:
	"Eval Region", "Scratch Buffer", "Apropos Package..."
	Added some bold to default SLDB faces.

2004-01-19  Alan Ruttenberg  <alanralanr@comcast.net>
        *swank-openmcl.lisp in frame-catch-tags, ppc32::catch-frame.catch-tag-cell -> 0,
	ppc32::catch-frame.csp-cell -> 3. FIXME when this code is more stable in openMCL.
	
2004-01-19  Michael Weber  <michaelw@foldr.org>

	* slime.el (slime-close-all-sexp): New command to close all
	unmatched parens in the current defun. Bound to `C-c C-]'. With
	prefix argument, only operate in the region (for closing
	subforms).

2004-01-19  Luke Gorrie  <luke@bluetail.com>

	* swank-openmcl.lisp (thread-id, thread-name): Fixed silly bugs
	(thanks Marco Baringer).

	* swank-loader.lisp: Call (swank:warn-unimplemented-interfaces).

	* swank.lisp (ed-in-emacs): New command with the same interface
	as CL:ED.

	* swank-cmucl.lisp, swank-sbcl.lisp, swank-lispworks.lisp,
	swank-openmcl.lisp, swank-allegro.lisp, swank-clisp.lisp: Updated
	to use `defimplementation'.

	* swank-backend.lisp (definterface, defimplementation): New macros
	as sugar around defgeneric/defmethod. This supports conveniently
	supplying a default (on NO-APPLICABLE-METHOD).  Because the
	underly mechanism is still generic functions this doesn't break
	code that isn't updated.
	(warn-unimplemented-interfaces): Print a list of backend functions
	that are not implemented.
	(xref and list-callers): Defined interfaces for these functions.
	(describe-definition): New function that takes over from the many
	other describe-* functions called from apropos listing. Takes the
	type of definition (as returned by describe-symbol-for-emacs) as
	an argument.

	* slime.el (sldb-enable-styled-backtrace): This is now true by
	default.
	(slime-keys): Bound `slime-inspect' to `C-c I'.
	(slime): `M-x slime' now offers to keep existing connections
	alive (else disconnect them). If you disconnect them, the new
	connection gets to reuse the existing REPL.
	(slime-connection): Error if the connection is closed.
	(slime-handle-oob): New message (:ED WHAT) for `slime-ed'.
	(slime-display-output-buffer): Don't pop up the REPL if it is
	already visible in any frame.
	(slime-find-asd): Handle case where (buffer-file-name) is nil.
	(slime-ed): Elisp backend for (CL:ED WHAT).
	(slime-apropos): Add a summary line to apropos listings.
	(slime-print-apropos): Replaced `action' property (name of lisp
	describe function) with `type' (argument to pass to unified
	swank:describe-definition function).
	(slime-apropos-package): New command on `C-c P'. Presents apropos
	listing for all external (with prefix also internal) symbols in a
	package.

2004-01-18  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank-lispworks.lisp (sigint-handler): Bind a continue restart.
	(make-dspec-location): Handle strings like pathnames.
	Some multithreading support.

	* slime.el (compile-defun): Don't use keywords.  The keyword
	package is locked in Lispworks and causes the test-suite to hang.
	(slime-eval-with-transcript): Fix bug triggered when 'package' is
	a buffer local variable.  Reported by Janis Dzerins.
	(slime-batch-test): Wait until the connection is ready.

2004-01-18 Alan Ruttenberg  <alanralanr@comcast.net>

	* swank-openmcl: Implement frame-catch-tags. Added debugger functions 
	sldb-restart-frame, sldb-return-from-frame. Should probably be added to backend.lisp
	but let's discuss first. Do other lisps support this?
	
	* slime.el sldb-restart-frame, sldb-return-from-frame

2004-01-18  Wolfgang Jenkner  <wjenkner@inode.at>

	* swank-clisp.lisp (call-without-interrupts): Evaluate
	linux:SIGFOO at read time since the macro with-blocked-signals
	expects a fixnum.
	(compile-file-for-emacs): Comment fix.

2004-01-18  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank-sbcl.lisp (make-fn-streams): Deleted.  Already defined in
	swank-gray.lisp.

	* swank.lisp (find-symbol-or-lose, format-arglist): New functions.
	(without-interrupts): New macro.
	(send-to-emacs): Use it.

	* swank-backend.lisp, swank-clisp.lisp, swank-lispworks.lisp,
	swank-openmcl.lisp, swank-sbcl.lisp, swank-allegro.lisp:
	(arglist-string): Refactor common code to swank.lisp.
	(call-without-interrupts, getpid): Are now generic functions.

	* slime.el (arglist): Test slot readers and closures.

	* swank-cmucl.lisp (arglist-string): Use
	pcl:generic-function-lambda-list for generic functions.  Handle
	closures.  Print arglist in lower case.
	(inspected-parts-of-value-cell): Was lost during the inspector
	refactoring.

2004-01-18  Wolfgang Jenkner  <wjenkner@inode.at>

	* swank-clisp.lisp (compile-file-for-emacs,
	split-compiler-note-line): Revert last change.
	(handle-notification-condition): Don't signal the condition.
	(*compiler-note-line-regexp*): Fix and rewrite it as extended
	regexp.

	* slime.el (slime-changelog-date): Use file-truename of
	byte-compile-current-file.
	
2004-01-17  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el (slime-format-arglist): Add some sanity checks and
	print zero argument functions nicer.  Suggested by Ivan Boldyrev.
	(slime-test-expect): Take test predicate as argument.
	(arglist): Test generic functions.

	* swank-cmucl.lisp (arglist-string): Handle generic functions
	better.  Reported by Ivan Boldyrev.

2004-01-16  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank-allegro.lisp: Multiprocessing support.

	* swank-openmcl.lisp, swank-cmucl.lisp, swank-backend.lisp,
	swank.lisp: Refactor inspector code.
	
	* swank.lisp (changelog-date): Use *compile-file-truename* instead
	of *compile-file-pathname*.
	(with-I/O-lock, with-a-connection): The usual CLISP fixes.
	(create-swank-server): Patch by Marco Baringer <mb@bese.it>.
	Bring it back again.
	(create-connection): Use return the dedicated output stream if
	available.

	* slime.el: Numerous REPL related fixes.
	(slime-update-state-name): Take state as argument.
	(slime-repl-beginning-of-defun, slime-repl-end-of-defun): Fix
	typos.
	(sldb-insert-restarts): Remove duplicate definition.

2004-01-16  Luke Gorrie  <luke@bluetail.com>

	* swank-openmcl.lisp: Multiprocessing support.

	* swank.lisp (changelog-date): make-pathname portability fix
	(from alanr).
	(with-io-redirection): Use (current-connection) instead of
	*dispatching-connection* (from alanr).

	* slime.el (slime-init-output-buffer): XEmacs portability fix, and
	use header-line-format to show info about Lisp in Emacs21.

2004-01-15  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank-sbcl.lisp, swank-cmucl.lisp (remove-input-handlers): New
	method.

	* swank-allegro.lisp (excl:stream-read-char-no-hang): Import it.
	(emacs-connected): Add default method.  The method for
	no-applicable-method doesn't seem to work.  ACL bug?

	* swank-loader.lisp (compile-files-if-needed-serially): Don't
	handle compilation errors.  We must compile everything because
	changelog-date requires *compile-file-truename*.

	* slime.el: (slime-changelog-date)
	(slime-check-protocol-version): New functions.
	(slime-handle-oob): Handle :check-protocol-version event.
	(slime-init-output-buffer): Print some info about the remote Lisp.
	(slime-connect): Use it.
	(slime-note-transcript-start): Renamed from
	slime-insert-transcript-delimiter.
	(slime-note-transcript-end): New function.
	(slime-with-output-end-mark, slime-repl-insert-prompt)
	(slime-repl-show-result, slime-compile-file)
	(slime-show-evaluation-result): Insert output from eval commands
	after the prompt and asynchronous output before the prompt.  Needs
	documentation.
	(repl-test, repl-read, interactive-eval-output): New tests.
	(slime-flush-output): Accept output from all processes.

	* swank.lisp (serve-requests): New function.
	(setup-server): Use it.
	(start-server): Pass backgroud to setup-server.
	(create-connection): Check the protocol version.
	(changelog-date): New function.
	(make-output-function): Use write-string instead of princ.

	* swank-backend.lisp (remove-input-handlers): New function.

2004-01-15  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-aux-connect, slime-handle-oob): Support for
	(:open-aux-connection port) message where Lisp requests that
	Emacs make a connection. These are "auxiliary" connections which
	don't (or at least shouldn't) have their own REPL etc.

	* swank.lisp: New support for multiprocessing and multiple
	connections + commentary.
	(with-a-connection): Macro to execute some forms "with a
	connection". This is used in the debugger hook to automatically
	create a temporary connection if needed (i.e. if the current
	thread doesn't already have one).
	(open-aux-connection): Helper function to create an extra
	connection to Emacs.

	* swank-sbcl.lisp: Implemented multiprocessing. Not perfect.

	* swank-cmucl.lisp: Implemented new multiprocessing interface.
	(create-socket): Make FDs non-blocking when multiprocessing is
	enabled.
	(startup-multiprocessing): Set *swank-in-background* to :spawn.

	* swank-backend.lisp: Changed multiprocessing interface.

2004-01-15  Wolfgang Jenkner  <wjenkner@inode.at>

	* swank-clisp.lisp (with-blocked-signals): New macro.
	(without-interrupts): Use it.
	(*use-dedicated-output-stream*, *redirect-output*): Don't set them
	here, use the default settings.
	Make :linux one of *features* if we find the "LINUX" package.

2004-01-14  Luke Gorrie  <luke@bluetail.com>

	* swank-openmcl.lisp (emacs-connected): Typo fix (missing
	close-paren).

2004-01-13  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el (slime-input-complete-p): Tolerate extra close parens.
	(slime-idle-state): Don't active the repl.
	(slime-insert-transcript-delimiter): Insert output before prompt.
	(slime-open-stream-to-lisp): Initialize the process-buffer with
	the connection buffer.
	(slime-repl-activate): Deleted.
	(slime-repl-eval-string, slime-repl-show-result)
	(slime-repl-show-abort): Better handling of abortion.
	(slime-compile-file): Insert output before prompt.

	* swank-lispworks.lisp (create-socket): Fix condition message.

	* swank-openmcl.lisp (*swank-in-background*): Set to :spawn.
	(emacs-connected): Initialize ccl::*interactive-abort-process*.

	* swank.lisp (*swank-in-background*): New variable.
	(start-server): Start swank in background, depending on
	*swank-in-background*.

	* swank-cmucl.lisp, swank-sbcl.lisp (*swank-in-background*): Set
	to :fd-handler.
	
	* swank-clisp.lisp (accept-connection): Remove superfluous call to
	socket-wait.

	New more direct socket interface.  The new interface is closer to
	the functions provided by the implementations.  For Lispworks we
	use some non-exported functions to get a sane interface.  The
	interface also includes add-input-handler and a spawn function
	(not used yet).  The idea is that most of the logic can be shared
	between similar backends.

	* swank-gray.lisp (make-fn-streams): New function.
	(stream-read-char-no-hang, stream-read-char-will-hang-p): Moved to
	here from swank-clisp.lisp.

	* swank-allegro.lisp, swank-clisp.lisp, swank-cmucl.lisp,
	swank-lispworks.lisp, swank-openmcl.lisp, swank-sbcl.lisp:
	(create-socket, local-port, close-socket, accept-connection)
	(add-input-handler, spawn): Implement new socket interface.

	* swank.lisp (start-server, open-dedicated-output-stream &etc):
	Use new socket functions.

	* swank-backend.lisp (create-socket, local-port, close-socket)
	(accept-connection, add-input-handler, spawn): New functions.
	(accept-socket/stream, accept-socket/run): Deleted.

2004-01-13  Luke Gorrie  <luke@bluetail.com>

	* swank-clisp.lisp: Updated for new network interface but not
	tested! Probably slightly broken.

	* swank-lispworks.lisp: Updated for new network interface.
	(accept-socket/stream): This function is currently broken, so
	LispWorks can't use the dedicated output channel at the moment.

	* swank.lisp, swank-cmucl.lisp, swank-sbcl.lisp: Updated for new
	network interface.

	* swank-backend.lisp (accept-socket/stream, accept-socket/run):
	New functions replacing the ancient (over 24 hours!)
	`create-socket-server'. This interface is much simpler.

2004-01-12  Luke Gorrie  <luke@bluetail.com>

	* swank-lispworks.lisp: Partially updated for new backend
	interface, but not actually working. The sockets code is broken, I
	haven't grokked LispWorks the interface properly.

	* swank-gray.lisp (slime-input-stream, slime-output-buffer): Added
	slots to support the new `make-fn-streams' interface from
	swank-backend.lisp. These slots need to be initialized by the
	backend, see swank-sbcl.lisp for an example (very easy).

	* swank-sbcl.lisp (create-socket-server): Implemented new server
	interface.

	* slime.el (slime-handle-oob): Added
	:open-dedicated-output-stream message, previously implemented
	with :%apply.
	(slime-repl-read-string, slime-repl-return-string): Pass integer
	argument to `slime-repl-read-mode' to set rather than toggle.

	* swank.lisp: Taking over previously non-portable jobs:
	(start-server): Now only uses sockets code from the backend.
	(handle-request): Top-level request loop.
	(open-dedicated-output-stream): Dedicated output socket.
	(connection): New data structure that bundles together the things
	that constitute a connection to Emacs: socket-level stream and
	user-level redirected streams.

	* swank-cmucl.lisp (create-socket-server): Generic TCP server
	driven by SERVE-EVENT.
	(serve-one-request, open-stream-to-emacs): Deleted. Now handled
	portably in swank.lisp.
	(make-fn-streams): Implement new stream-redirection interface.
	(slime-input-stream): New slot referencing output sibling, so it
	can be forced before input requests.

	* swank-backend.lisp (create-socket-server): Generic
	callback-driven TCP server interface. Replaces
	`create-swank-server', with the higher-level logic moved into
	swank.lisp.
	(emacs-connected): Invoked when Emacs initially connects, as a
	hook for backend implementations.
	(make-fn-streams): Interface for creating pairs of input/output
	streams that are backended by callback functions. Used to
	implement redirected-via-Emacs standard I/O streams.

2004-01-12  Lawrence Mitchell  <wence@gmx.li>

	* slime.el (slime-events-buffer): Set `hs-block-start-regexp'
	before running `hs-minor-mode'.

2004-01-10  Luke Gorrie  <luke@bluetail.com>

	* slime.el (package-updating): Expected package is now a list (can
	be any), since the shortest nickname is not
	standardized. e.g. USER or CL-USER for COMMON-LISP-USER.

	* swank-cmucl.lisp: Don't enable xref (let the user decide).
	(set-fd-non-blocking): Removed unused function.
	Miscellaneous refactoring of the networking code.

	* slime.el (slime-complete-symbol): Use markers to hold the
	beginning and end of the completion prefix, in case looking up
	completions causes insertions (e.g. GC announcements).

2004-01-09  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-activate-state): Only update state name when
	`slime-default-connection' activates. This fixes an annoying
	"Selecting deleted buffer" bug that prevented SLIME from being
	restarted.
	(slime-next-connection): Fixed a bug where buffer-local connection
	bindings could get in the way and prevent the connection from
	actually changing.
	(slime-complete-restore-window-configuration): Wrap
	`set-window-configuration' in `save-excursion'. This fixes a
	problem where the cursor would end up in the wrong place after
	completion in XEmacs.

2004-01-09  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el: Place (require 'cl) inside a eval-and-compile.
	(slime-with-connection-buffer): Move definition upwards before the
	first use.
	(package-updateing): New test for package updates in the listeners.

	* swank.lisp (eval-region): Bind *package* outside the
	unwind-protect to detect updates.

	* swank-backend.lisp (debugger-info-for-emacs)
	(find-function-locations): Doc fix.

2004-01-09  Wolfgang Jenkner  <wjenkner@inode.at>

	* swank-clisp.lisp: Add methods for GRAY:STREAM-READ-CHAR-NO-HANG
	and for the CLISP specific GRAY:STREAM-READ-CHAR-WILL-HANG-P.
	This should fix the behaviour of SYS::READ-FORM.

2004-01-08  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-inspector-fontify): Function to insert a string
	in a particular inspector face. Replaces macro-code-generation
	function `slime-inspector-expand-fontify'. Fixes a byte-compile
	problem (macro was calling function not defined at compile-time).

2004-01-07  Luke Gorrie  <luke@bluetail.com>
	
	* slime.el: Multisession internal improvements. Now there are
	three separate connection variables, in order of priority:
	  slime-dispatching-connection (dynamically-bound)
	  slime-buffer-connection      (buffer-local)
	  slime-default-connection     (global)
	The most specific one available is used. This is splitting
	`slime-connection' into multiple variables, so that you can be
	specific about what you want to assign (i.e. know if you're
	setting a dynamic binding or a buffer-local one).
	Fixed some related bugs.
	(slime-connection-close-hook): If default connection closes,
	select another connection.
	(slime-lisp-package): Initially CL-USER nickname instead of
	COMMON-LISP-USER (for REPL prompt).

	* slime.el (slime): Multisession support: with prefix argument,
	gives the option of keeping existing sessions and firing up an
	additional *inferior-lisp* to connect to. Each connection now has
	its own *slime-repl[<n>]* buffer.
	(slime-connection): Should now be read via the function of the
	same name. The accessor will check if the value is NIL, and if so
	use `slime-default-connection'.
	(slime-default-connection): The connection that will be used by
	default, i.e. unless `slime-connection' is bound. Renamed from
	`slime-primary-connection'.
	(slime-init-connection-state): When reconnecting, update the
	`slime-connection' binding in the REPL to use the new connection.
	(slime-repl-input-history, ...): REPL variables are now
	buffer-local.

2004-01-06  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank.lisp (eval-string): New argument 'id'.  Used to identify
	the remote continuation.
	(log-event): New debugging function.
	(read-from-emacs, send-to-emacs): Use it.

	* slime.el: The new macro 'slime-rex' can now be used to evaluate
	sexps remotely.  It offers finer control what to do when the
	evaluation aborts.
	(slime-rex): New macro
	(slime-eval, slime-eval-async, sldb-continue)
	(sldb-invoke-restart): Use it.
	(slime-continuation-counter, slime-push-evaluating-state): New
	functions.
	(slime-output-buffer): Initialize markers.
	(sldb-mode): XEmacs doesn't like (add-hook (make-local-hook ...)).
	(slime-init-connection): New optional argument SELECT.
	(slime-def-connection-var): Workarounds for Emacs 20 reader bugs.
	Backquote is pretty broken Emacs 20.
	
2004-01-06  Ignas Mikalajunas <i.mikalajunas@mbt.lt>

	* swank-loader.lisp (user-init-file): Use merge-pathames.  Fix
	Windows support.

2004-01-05  Luke Gorrie  <luke@bluetail.com>

	* slime.el: Multiple session support, i.e. Emacs can open
	multiple connections to Lisps. The guts is there, but
	user-interface is currently minimal.
	(slime-net-process): Replaced with slime-net-processes.
	(slime-net-send): Take process as argument.
	(slime-process-available-input): Poll all connections.
	(slime-connection): Current connection (process) to use for
	talking to Lisp. Can be bound dynamically or buffer-local.
	(slime-with-connection-buffer): Macro to enter the process-buffer
	of `slime-connection' to manipulate the local variables.
	(slime-stack-stack): Now buffer-local in the process-buffer of
	each connection.
	(slime-push-state, slime-pop-state): Operate on the stack inside
	`slime-connection's process-buffer.
	(slime-dispatch-event): Take optional process argument, to bind
	`slime-connection' appropriately when events arrive from the
	network.
	(slime-def-connection-var): Macro to define variables that are
	"connection-local". Such variables are used via (setf'able)
	accessor functions, and their real bindings exist as local
	variables in the process-buffers of connections. The accessors
	automatically work on `slime-connection'.
	(slime-lisp-features, slime-lisp-package, slime-pid, sldb-level):
	These variables are now connection-local.
	(slime-read-from-minibuffer): Inherit `slime-connection' as
	buffer-local so that we complete towards the right Lisp.
	(sldb-mode): Inherit `slime-connection' as buffer-local so that we
	debug towards the right Lisp.
	(get-sldb-buffer): New function to return (optionally create) the
	SLDB buffer for the current connection. Since multiple Lisps can
	be debugged simultaneously, the buffername now includes the
	connection number.
	(slime-connection-abort): New command to abort a connection
	attempt (don't use `slime-disconnect' anymore - that closes all
	connections).
	(slime-execute-tests): Honor `slime-test-debug-on-error'.
	(slime-next-connection): Cycle through open Lisp connections.

2004-01-02  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el (slime-display-output-buffer): Move the output markers
	to the end of the buffer.

	* swank-clisp.lisp (frame-do-venv): Rename the :symbol property to
	:name.
	(format-condition-for-emacs): Replaced with
	debugger-condition-for-emacs.
	(backtrace): Use print-with-frame-label.
	
	* swank-openmcl.lisp (format-condition-for-emacs): Replaced with
	debugger-condition-for-emacs.
	(backtrace): Use print-with-frame-label.
	(frame-locals): Rename the :symbol property to :name.

	* swank-lispworks.lisp (format-condition-for-emacs): Replaced with
	debugger-condition-for-emacs.
	(backtrace): Use print-with-frame-label.
	(frame-locals): Rename the :symbol property to :name.

	* swank-allegro.lisp (frame-locals): Rename the :symbol property
	to :name.
	(format-condition-for-emacs): Replaced with
	debugger-condition-for-emacs.
	(backtrace): Use print-with-frame-label.

	* swank-sbcl.lisp (tracedp, toggle-trace-fdefinition)
	(format-condition-for-emacs): Remove unused functions.
	(format-frame-for-emacs): Use print-with-frame-label.
	(compute-backtrace): Simplified.
	(backtrace): Return our frame numbers.
	(frame-locals): Rename the :symbol property to :name.  Remove the
	:validity property.
	
	* swank-cmucl.lisp (accept-loop, safe-definition-finding): Doc
	fix.
	(location-buffer=, file-xrefs-for-emacs)
	(sort-contexts-by-source-path, source-path<)
	(format-condition-for-emacs): Remove unused functions.
	(format-frame-for-emacs): Don't include the frame number in the
	description, but use the frame number for indentation. Update
	callers.
	(frame-locals): Rename the :symbol property to :name.
	
	* slime.el (slime-add-face): New function.
	(sldb-add-face): Use it.
	(sldb-setup): Some refactoring.
	(sldb-insert-condition): New function.  Factorized from
	sldb-setup.  Message and types are now separate.
	(sldb-insert-restarts): New function.  Factorized from sldb-setup.
	(sldb-insert-frame): Factorized from slime-insert-frames. The
	frame number in no longer part of the string describing the frame.
	(sldb-insert-frames): Use it.
	(sldb-show-frame-details): Print frame numbers.  Fix printing of
	catch tags.  Move to the start of the frame before at the
	beginning to get unfontified text properties.
	(sldb-inspect-condition): New command.
	(sldb-insert-locals): The :symbol property is now called :name.
	Fix locals with :id attribute.
	(slime-open-inspector): Fix the bugs I introduced last time.
	
	* swank.lisp (safe-condition-message): New function.
	(debugger-condition-for-emacs): Used to be
	format-condition-for-emacs in each backend.  Separate the
	condition message from the type description.  Update all backends
	accordingly.
	(print-with-frame-label): New function. 
	
	* slime.el (slime-hyperspec-lookup): New function.

2004-01-02  Wolfgang Jenkner <wjenkner@inode.at>

	* swank-clisp.lisp: New file.  Merged with Vladimir's version.

	* xref.lisp: New file.  Used by swank-clisp.

	* swank-loader.lisp (user-init-file): Add CLISP files.
	
	* swank.lisp (eval-region, tokenize-completion): Modify loops a
	bit to make CLISP happy.

	* swank-backend.lisp (with-compilation-hooks): Replace () with
	(&rest _) to make CLISP happy.

	* slime.el (slime-goto-source-location): Support for CLISP style
	line numbers. Split it up.
	(slime-goto-location-buffer, slime-goto-location-position): New
	functions.
	(slime-load-system): Use slime-display-output-buffer.
	(slime-repl-mode): Disable conservative scrolling. Not sure if it
	was a good idea.
	(sldb-insert-frames, sldb-show-frame-details, sldb-list-locals):
	Minor fixes.
	(sldb-insert-locals): Renamed from sldb-princ-locals.
	(sldb-invoke-restart): Use slime-eval instead of
	slime-oneway-eval, because interactive restarts may read input.
	(slime-open-inspector): Minor indentation fixes.
	(slime-net-output-funcall): Removed.  Was unused.

2003-12-19 Alan Ruttenberg <alanralanr@comcast.net>
	* slime.el 1.157
	fix bug in sldb-princ-locals I introduced when adding fonts to sldb
	
2003-12-19 Alan Ruttenberg <alanralanr@comcast.net>
	* swank-openmcl.lisp 1.42
	in request-loop register output stream to be periodically slushed per Gary Byer's email.
	* slime.el 1.156
	slime-goto-source-location. Sometimes source information is recorded but it isn't a standard "def"
	in that case, don't error out, just look for the most likely place for the definition. 
	
2003-12-19  Luke Gorrie  <luke@bluetail.com>

	* null-swank-impl.lisp: Deleted this old file. See
	swank-backend.lisp instead.

2003-12-18 Alan Ruttenberg <alanralanr@comcast.net>
	* swank-openmcl.lisp 1.41
	in openmcl (break) now goes into slime debugger. 
	(setq swank:*break-in-sldb* nil) to disable that.
	
2003-12-17 Alan Ruttenberg <alanralanr@comcast.net>
        * slime.el 1.155
        Allow font choices for backtrack. Add group for customizing them: sldb.
	Whole thing is enabled with sldb-enable-styled-backtrace which is off by default, for now.
	Try
	 '(sldb-condition-face ((t (:foreground "DarkSlateGray" :weight bold))))
	 '(sldb-detailed-frame-line-face ((t (:foreground "brown" :weight bold :height 1.2))))
	 '(sldb-local-name-face ((t (:weight bold))))
	 '(sldb-restart-face ((t (:foreground "DarkBlue" :weight bold))))
	 '(sldb-restart-number-face ((t (:underline t :weight bold))))
	 '(sldb-restart-type-face ((t (:foreground "DarkSlateGrey" :weight bold))))
	 '(sldb-section-face ((t (:weight bold :height 1.2))))
	 '(sldb-selected-frame-line-face ((t (:foreground "brown" :weight bold :height 1.2))))
	 '(sldb-topline-face ((t (:foreground "brown" :weight bold :height 1.2))))

2003-12-17 Alan Ruttenberg <alanralanr@comcast.net>
        * slime.el 1.154
	Allow some face choices in the inspector. Try
	 '(slime-inspector-label-face ((t (:weight bold))))
	 '(slime-inspector-topline-face ((t (:foreground "brown" :weight bold :height 1.2))))
	 '(slime-inspector-type-face ((t (:foreground "DarkRed" :weight bold))))
	You can also set slime-inspector-value-face
	
2003-12-17 Alan Ruttenberg <alanralanr@comcast.net>

	* swank-openmcl.lisp 1.40
	Fix an error with frame-source-location-for-emacs when the
	function was a method-function.
	Defined method-source-location that handles this case. You can
	still end up looking at the wrong definition, as the protocol
	doesn't allow passing back the qualifiers and specializers to look
	up the correct one in the file

.	* swank-openmcl.lisp 1.39
	Allow you to continue after interrupting. 
	Properly set *swank-debugger-stack-frame* when interrupting.

	* slime.el 1.152
	sldb-continue now uses slime-oneway-eval
	
2003-12-17  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el: Better handling of asynchronous output.
	(slime-output-end): New variable.  Use this marker to insert
	output.  Insert asynchronous output inserted before the "input
	region" and before the prompt.
	(slime-show-last-output): Use it.
	(slime-repl-insert-prompt): Initialize it.
	(slime-last-output-start): Removed.
	(slime-flush-output): Increase delay to 20 usecs.
	(slime-with-output-end-mark): Renamed from
	slime-with-output-at-eob.  Insert a newline if needed.
	(slime-output-string, slime-repl-activate): Use it.
	(slime-repl-return): Ensure that slime-repl-input-end-mark points
	to a reasonable location.
	
2003-12-17  Luke Gorrie  <luke@bluetail.com>

	* HACKING: New file summarising our way of working.

2003-12-16  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-lisp-preferred-package-nicknames): Removed. Not
	very interesting (and slightly broken) now that shortest-nicknames
	are automatically used.
	(slime-output-oneway-evaluate-request): New function to evaluate
	an expression for side-effects (without getting a
	result).
	(slime-idle-state): Handle new :emacs-evaluate-oneway.
	(slime-debugging-state): Handle :emacs-evaluate-oneway.
	(sldb-invoke-restart): Use slime-oneway-eval. This avoids pushing
	an evaluating state (which will be aborted, and print an unnecessary
	message saying so).
	(sldb-break-with-default-debugger): New command to break into the
	default TTY debugger. Bound to 'B' in *sldb*.
	(slime-read-string-state): Added :emacs-evaluate-oneway.

	* swank.lisp (invoke-nth-restart-for-emacs): Wrapper around
	INVOKE-NTH-RESTART that checks that Lisp and Emacs agree on the
	debug level. This detects and ignores old restart requests when
	several are sent at once (possible because of new oneway-eval
	feature).
	(oneway-eval-string): New function to evaluate a string without
	sending a result, and with *DEBUGGER-HOOK* bound to NIL. (The
	debugger hook is inhibited to avoid state conflicts.)

2003-12-15  Luke Gorrie  <luke@bluetail.com>

	* swank-openmcl.lisp (ccl::*warn-if-redefine-kernel*): Support for
	interrupting the listener (by Alan Ruttenberg).

2003-12-15  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank.lisp *start-swank-in-background*: Set to t by default.

	* slime.el (slime-eval-last-expression-display-output): New
	command.  Bound to C-x M-e.  Suggested by Nicolas Neuss.
	(slime-display-output-buffer): New function.
	(slime-slime-compile-file): Use it.

2003-12-15  Luke Gorrie  <luke@bluetail.com>

	* swank.lisp (*processing-rpc*, *multiprocessing-enabled*,
	*debugger-hook-passback*): New variables.
	(with-conversation-lock, with-I/O-lock): New macros.
	(read-next-form): Use with-I/O-lock.
	(send-to-emacs): Use with-I/O-lock.
	(swank-debugger-hook): When called asynchronously (i.e. not
	during RPC) and multiprocessing is enabled, suspend until
	acknowleged by Emacs.
	(install-global-debugger-hook): Install a SLIME-DEBUGGER-FUNCTION
	globally on *DEBUGGER-HOOK*.
	(startup-multiprocessing-for-emacs): Called to initialize multiprocessing.
	(eval-string): Dynamically set the *PROCESSING-RPC* flag.
	(eval-string): Nasty hack with *DEBUGGER-HOOK-PASSBACK* to
	install debugger hook. Temporary, I swear!
	(eval-region, shortest-package-nickname): Report the shortest
	package nickname to Emacs (for the REPL prompt). Patch from Marco
	Baringer.

	* swank-backend.lisp: Defined multiprocessing interface.

	* swank-cmucl.lisp: Implmemented the multiprocessing interface.

	* slime.el (slime-multiprocessing): When true, use
	multiprocessing in Lisp if available.
	(slime-global-debugger-hook): When true, globally set
	*debugger-hook* to use the SLIME debugger. For use with
	SERVE-EVENT and multiprocessing.
	(slime-handle-oob): Handle :AWAITING-GOAHEAD message from threads
	that have suspended to wait for Emacs's attention.
	(slime-give-goahead): New command to allow a suspended thread to
	continue (bound to RET in the thread-control-panel).
	(slime-thread-control-panel): New command to display a buffer
	showing all threads that are suspending waiting for Emacs's
	attention. Bound to `C-c C-x t'.
	(slime-popup-thread-control-panel): When true, automatically
	popup the thread-control buffer when a new thread suspends.

2003-12-14  Alan Ruttenberg <alanralanr@comcast.net>

	* swank-openmcl.lisp (eval-in-frame, inspect-object and friends):
	Most of this is copied from swank-cmucl. The parts between &&&&&
	are what I added for openmcl. I piggyback off the inspector which
	is shipped with openmcl, so inspecting won't look the same as it
	would in cmucl, I imagine. Still, it's a start.  eval in frame
	uses frame-locals to get bindings so if you have debug settings
	low or don't have *save-local-symbols* set you won't be able to
	evaluate.
		
2003-12-14  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank-lispworks.lisp (tracedp, toggle-trace-fdefinition): Moved
	to swank.lisp.

	* swank-allegro.lisp (create-swank-server): Add support for
	BACKGROUND and CLOSE argument.
	(call-with-debugging-environment): Use excl::int-newest-frame to
	avoid the kludge with *break-hook*.
	(sldb-abort): New function.
	(frame-source-location-for-emacs): Dummy definition.
	(compile-file-for-emacs): The argument is called
	:load-after-compile and not :load.
	(xref-results-for-emacs): Use dolist instead of loop.

	* swank-openmcl.lisp (create-swank-server): Add support for
	BACKGROUND and CLOSE argument.
	(open-stream-to-emacs): Support for dedicated output stream.

	* swank.lisp: *start-swank-in-background*,
	*close-swank-socket-after-setup*, *use-dedicated-output-stream*:
	Moved here from swank-cmucl.
	(sldb-continue): Don't pass the condition as argument, because
	that doesn't work with Allegro.
	(toggle-trace-fdefinition, tracedp): Replace backend specific code
	with portable, but ugly, calls to eval.

	* swank-cmucl.lisp (compile-system-for-emacs): Add method for
	CMUCL.

	* slime.el (slime-goto-source-location): Better regexp for package
	qualified symbols.  Allow dashes in the name and two colons.
	Reported by Alan Ruttenberg.

2003-12-13  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank-openmcl.lisp (create-swank-server): Interrupt the right
	thread.  Patch by Alan Ruttenberg.  Not yet enabled, due to lack
	of test platform.
	(sldb-disassemble): Implement sldb-disassemble command.  Patch by
	Alan Ruttenberg.
	Remove #' from lambdas.

2003-12-12  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank-cmucl.lisp (create-swank-server): New keyword arguments to
	control the server: BACKGROUND and CLOSE.  fd-handlers are used if
	BACKGROUND is true.  If close CLOSE is true, close the socket
	after the first connection; keep it open otherwise.
	*start-swank-in-background*, *close-swank-socket-after-setup*: The
	default values of the corresponding arguments for
	create-swank-server.
	(compile-file-for-emacs): Don't load the fasl-file when the
	compilation failed.

	* swank-openmcl.lisp (toggle-trace-fdefinition, tracedp):
	Implement trace command.  Patch by Alan Ruttenberg.
	(find-function-locations, find-source-locations): Handle
	variables, and method-combinations.  General cleanups.
	(source-info-first-file-name): Removed.
	(list-callers): Fixed.
	(list-callers): Fixed some more.  method-name is not exported in
	0.14.  From Marco Baringer.
	(swank-accept-connection): Accept multiple connections.  Patch by
	Marco Baringer.

	* swank-loader.lisp (user-init-file): Use homedir's truename.
	Reported by Friedrich Dominicus.

	* slime.el (slime-repl-current-input): Don't remove the final
	newline if we are in reading state.
	(slime-goto-source-location): Regex-quote the function-name and
	handle package prefixes.  Reported by Alan Ruttenberg.
	(slime-output-string): Insert asynchronous output before the
	prompt.

2003-12-12  Daniel Barlow  <dan@telent.net>

	* swank-source-path-parser.lisp: new file, excerpting part of
	swank-cmucl.lisp to where SBCL can find it as well.

2003-12-11  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-one-line-ify): New function to convert
	multi-line strings to one-liners by replacing any newline
	followed by indentation by a single space.
	(slime-xrefs-for-notes): Use it.

2003-12-11  Daniel Barlow  <dan@telent.net>

	* swank-sbcl.lisp (compiler-note-location): replace with
	thinly-ported version from the CMUCL backend which understands
	:lisp as a pathname

	* slime.el (slime-xrefs-for-notes): a little more temporary
	variables, a little less cdr.  Should be slightly faster on
	big systems
	(slime-goto-next-xref): set window point as well as buffer point -
	now works in GNU Emacs 21.2.1 

	* swank.lisp (swank-compiler): new function abstracts commonality
	between swank-compile-{file, string}.
	(swank-load-system): call swank-compiler to load asdf system

	* swank-sbcl.lisp (compiler-note-location and elsewhere): 
	remove all trace of *compile-filename*
	(compile-*-for-emacs): shorten

	* swank-backend.lisp (call-with-compilation-hooks): new GF
	should set up all appropriate error condition loggers etc
	to do a compilation preserving the notes.  Implement for
	sbcl, cmucl

	* slime.el (slime-find-asd, slime-load-system): new command
	to compile and load an ASDF system with all the usual compiler
	notes and stuff
	(slime-compilation-finished): if more than one file has new 
	errors/notes, create an xref buffer to show them all
	(slime-remove-old-overlays): bug fix: now removes overlays even
	at start of buffer
	(slime-overlay-note): do nothing quietly if
	slime-choose-overlay-region returns nil
	(slime-choose-overlay-region): return nil if note has no location

2003-12-11  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el (slime-repl-previous-prompt, slime-repl-next-prompt):
	New commands.  Suggested by Håkon Alstadheim.
	(slime-repl-beginning-of-defun, slime-repl-end-of-defun): New
	commands.  Suggested by Andreas Fuchs.
	(slime-repl-insert-prompt): Mark the prompt with a
	slime-repl-prompt text property.
	(slime-repl-eol): New function. Mostly for symmetry.
	(slime-repl-in-input-area-p, slime-repl-at-prompt-end-p): New
	predicates.
	(slime-repl-find-prompt, slime-search-property-change-fn): New
	functions.
	(slime-ir1-expand): New command.

	* swank-cmucl.lisp (accept-connection, request-loop): Don't use
	fd-handlers. The code for the request-loop itself is now almost
	the same as in the Allegro version.
	(print-ir1-converted-blocks, expand-ir1-top-level): New functions.

2003-12-10  Daniel Barlow  <dan@telent.net>

	* swank-sbcl.lisp (serve-request): more fiddling with serve-event
	descriptors

	* slime.el (slime-repl-return): slime-check-connected, otherwise
	pressing Return in an unconnected repl gets a bit weird 

2003-12-10  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank-allegro.lisp, swank-lispworks.lisp, swank-openmcl.lisp,
	swank-sbcl.lisp (create-swank-server): Accept an announce-function
	keyword argument.

	* swank.lisp (start-server): Pass an announce callback function to
	create-swank-server.  Works better with single threaded
	implementations.
	(announce-server-port, simple-announce-function): New functions.
	(alistify): Doc fix.

	* swank-cmucl.lisp (create-swank-server): Use announce callback.
	(sldb-disassemble): New function.

	* slime.el (sldb-disassemble): New command. Bound to D.

2003-12-08  Luke Gorrie  <luke@bluetail.com>

	* swank-cmucl.lisp (*debug-definition-finding*): Now nil by
	default, so that errors while looking for definitions are printed
	as a message and not debugged.

	* slime.el (slime-read-from-minibuffer): Now the only
	completing-read function, stale ones deleted.

2003-12-07  Luke Gorrie  <luke@bluetail.com>

	* slime.el (sldb-prune-initial-frames): Use regexp-heuristics and
	the '--more--' token to avoid showing the user Swank-internal
	backtrace frames initially.
	(slime-repl-current-input): Don't include the final newline
	character, to make backtraces prettier.
	(slime-autodoc): Fixed annoying case where autodocs would be
	fetched in a loop for undocumented symbols.

	* swank.lisp (compound-prefix-match): New name and rewritten for
	speed. Completion is much faster now.
	(*sldb-initial-frames*): Send up to this many (default 20)
	backtrace frames to Emacs when entering the debugger.

2003-12-07  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank-allegro.lisp, swank-backend.lisp, swank-cmucl.lisp,
	swank-lispworks.lisp, swank-openmcl.lisp, swank-sbcl.lisp
	(function-source-locations): Make it at generic function.
	(function-source-location-for-emacs): Removed.  Fixes bug reported
	by Marco Baringer.

	* slime.el (slime-interactive-eval): Insert the result at point,
	if called with prefix argument.

2003-12-06  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-easy-menu): Added menubar support, contributed
	by Friedrich Dominicus.

2003-12-06  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank-allegro.lisp: New file.

	* swank-loader.lisp (user-init-file): Translate logical
	pathnames.  Reported by Friedrich Dominicus.

	* swank-sbcl.lisp (handle-notification-condition): Don't ignore
	warnings without context.
	(compiler-note-location, brief-compiler-message-for-emacs,
	compiler-note-location): Handle null context.
	(compile-file-for-emacs): Bind *compile-filename* and load the
	fasl file only if it exists.
	(function-source-location): The name argument is now optional and
	should be a symbol.
	(find-function-locations): Return errors as a list of one error.
	(call-with-debugging-environment): Set *print-level* to 4 and
	*print-length* to 10.  (Both where nil.)
	(source-location-for-emacs): Fall back to the location of the
	function, if there is no debug-block-info.
	(safe-source-location-for-emacs): Don't catch all conditions; only
	errors.  
	*compile-filename*: New variable
	(open-listener): Don't make the socket non-blocking.

	* slime.el (slime-eval/compile-defun-dwim): New command.
	Suggested by "jan" <janmar@iprimus.com.au>.

2003-12-04  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el (slime-debugging-state): Don't set sldb-level after
	sldb-setup. Breaks the test-suite.
	(slime-eval-defun): Fix typos.
	(slime-xref-buffer, slime-goto-next-xref): Updated for the new
	xref code.
	(sldb-inspect-in-frame): Query with the sexp at point as initial
	value.
	(sldb-step): New command. Bound to s.

	* swank-cmucl.lisp (format-frame-for-emacs, compute-backtrace,
	backtrace): Don't send CMUCL's frame numbers to Emacs, use our own
	numbering.
	(set-step-breakpoints, sldb-step): Lisp side of sldb-step command.

2003-12-04  Luke Gorrie  <luke@bluetail.com>

	* hyperspec.el: Updated URL to point to a live copy of the
	hyperspec at lispworks.com, because the one on xanalys.com has
	disappeared. Patch from Vincent Arkesteijn on the ilisp-devel
	mailing list.

2003-12-04  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank-lispworks.lisp (toggle-trace-fdefinition, tracedp): New
	support functions for toggle-trace command.  Written by Alain
	Picard.
	(compile-from-temp-file): Don't delete the binary file if there is
	none.
	(lispworks-severity): Map all ERRORs to :error.

	* slime.el (slime-eval-defun): Use slime-re-evaluate-defvar if the
	defun starts with "defvar".  C-M-x in elisp does this too.
	(slime-re-evaluate-defvar): Take the form as argument.

2003-12-03  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el (slime-debugging-state): Initialize the sldb-buffer if
	(/= sldb-level level).
	(slime-who-specializes): New command.

	* swank-cmucl.lisp (create-swank-server): Set reuse-address to t
	by default.
	(resolve-note-location): Add method for warnings in interpreted
	code.
	(who-specializes): New function.
	(dd-source-location): Handle case without constructors more
	correctly.
	(source-path-source-position): Skip ambigous entries in
	source-map.
	(source-location-from-code-location): Simplified.

2003-12-03  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-completing-read-internal): Fix from Sean
	O'Rourke.

2003-12-02  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank-sbcl.lisp (find-function-locations): Return a non-empty
	list of source locations.

	* slime.el (slime-with-xref-buffer): Remove spurious comma. (Bug
	reported by Raymond Wiker).  Some reordering of the xref code.

	* swank.lisp (documentation-symbol): New optional argument for
	return value if the symbol is not documented.

2003-12-02  Sean O'Rourke  <sorourke@cs.ucsd.edu>

        * slime.el: (slime-repl-{clear-buffer,clear-output}): clear the
	last and entire output in the *slime-repl* buffer
	(slime-documentation): pop up a buffer with a symbol's
	documentation instead of its description, if found.
	(slime-complete-symbol): tweak the completion, taken from ilisp, to
	complete filenames inside strings.
	(slime-set-default-directory): also set *slime-repl*'s
	default-directory, so e.g. find-file makes sense.
	
2003-12-02  Daniel Barlow  <dan@telent.net>

	* slime.el (slime-with-xref-buffer): moved further up the file so
	it's defined before slime-show-xrefs needs it

	* swank-sbcl.lisp (function-source-location-for-emacs): return a
	list of source locations (one per method) when the request is
	for a GF.  This seems to make the elisp side popup a window
	to let the user select one.  Cool.

2003-12-01  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank-[cmucl,sbcl,openmcl,lispworks].lisp (invoke-nth-restart):
	Use invoke-restart-interactively.

	* slime.el (slime-create-note-overlay, slime-sexp-depth): The
	'priority' property is unused. Remove it.

	* swank-openmcl.lisp (find-function-locations): Return all methods
	for generic functions. Doesn't work very well if multiple methods
	are in the same file.
	(swank-accept-connection): Don't create an extra thread, call
	request-loop directly.

2003-12-01  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-repl-return): Goto end of input area before
	inserting newline.
	(slime-autodoc-message-ok-p): Test to see if a documentation
	message should be printed (returns nil if the
	minibuffer/echo-area is already being used).
	(slime-symbol-at-point): Skip back over whitespace before
	looking for the symbol.
	(slime-autodoc-delay): New configurable to specify the delay
	before printing an autodoc message (default 0.2 secs).
	(slime-ensure-typeout-frame): New function to call create a
	typeout frame unless it already exists. Suitable to run on
	slime-mode-hook if you always want to have a typeout window.
	(slime-log-events): When nil, don't log events to
	*slime-events*. This works-around a problem Raymond Toy has when
	starting SLIME under XEmacs. Still investigating..

2003-11-29  Helmut Eller  <e9626484@stud3.tuwien.ac.at>
	
	* slime.el: Rewrite the xref code to work with other source
	locations.
	(slime-edit-fdefinition): Use the xref window to display generic
	functions with methods.
	(slime-goto-source-location): New representation for source
	locations. Drop old code.
	(slime-list-callers, slime-list-callees): Use the xref window.
	Remove the slime-select-* stuff.
	(slime-describe-function): New command. Bound to C-c C-f.
	Primarily useful in Lispworks.
	(slime-complete-symbol): Display the completion window if the
	prefix is complete but not unique.
	(slime-forward-positioned-source-path): Enter the sexp only if the
	remaining sourcepath is not empty.
	(slime-read-symbol-name): New optional argument QUERY forces
	querying.

	* swank.lisp (group-xrefs): Handle unresolved source locations.
	(describe-symbol): Print something sensible about unknown symbols.

	* swank-cmucl.lisp: Use the new format for source locations.
	(find-function-locations): New function.  Replaces
	function-source-location-for-emacs.  Returns a list of
	source-locations.
	(resolve-note-location): Renamed from resolve-location.
	Simplified.
	(brief-compiler-message-for-emacs): Print the source context
	 (that's the thing after ==>).
	(who-xxxx): Take strings, not symbols, as arguments.
	(function-callees, function-callers): Use the same format as the
	who-xxx functions.  Support for byte-compiled stuff.
	(code-location-stream-position): Try to be clever is the source
	path doesn't match the form.
	(call-with-debugging-environment): Bind *print-readably* to nil.

	* swank-lispworks.lisp: Use the new format for source
	locations. Implement the find-function-locations.
	(list-callers, list-callers): New functions.

	* swank-sbcl.lisp, swank-openmcl.lisp: Use the new format for
	source locations and implement find-function-locations (just calls
	the old code).

2003-11-29  Daniel Barlow  <dan@telent.net>

	* swank-sbcl.lisp (source-location-for-emacs):
	sb-debug::print-description-to-string takes only two args, not
	three.  Now 'v' command works in sldb :-)

	* slime.el (slime-idle-state): added :debug as a valid transition

	* swank.lisp (slime-debugger-function): New.  Returns a function
	suitable for use as the value of *DEBUGGER-HOOK* to install the
	SLIME debugger globally.  Must be run from the *slime-repl* buffer
	or somewhere else that the slime streams are visible so that it
	can capture them.  e.g. for Araneida:
	PKG> (setf araneida:*restart-on-handler-errors* 
	           (swank:slime-debugger-fucntion))

2003-11-29  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el: Some tweaking to the REPL.  slime-repl-input-end-mark
	is now always left inserting and slime-mark-input-end
	"deactivates" the end mark by moving it to the beginning of the
	buffer.
	(slime-goto-source-location): Next try for more uniform
	source-locations.  A source-location is now a structure with a
	"buffer-designator" and  "position-designator".  The buffer-designator
	open the file or buffer and the position-designator moves point to the
	right position.
	(slime-autodoc-mode): New command.
	(slime-find-fdefinitions): Experimental support for generic functions
	with methods.
	(slime-show-xrefs, slime-insert-xrefs, slime-goto-xref): Rewritten to
	work with more general source locations.

	* swank.lisp: Structure definitions for source-locations.
	(alistify, location-position<, group-xrefs): Utilities for xref
	support.

	* swank-cmucl.lisp (code-location-source-location): Renamed from
	safe-source-location-for-emacs.
	(code-location-from-source-location): Renamed from
	source-location-for-emacs.
	(find-fdefinitions, function-source-locations): New functions.
	(safe-definition-finding): New macro.

	* swank-lispworks.lisp: Xref support.
	(make-dspec-location): Updated for the new source-location format.

2003-11-29  Luke Gorrie  <luke@bluetail.com>

	* slime.el (complete-symbol, arglist): Updated test cases for new
	completion interface.

2003-11-28  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-complete-symbol): Use the new completion
	support from the Lisp side. Don't obscure minibuffer input with
	completion messages.

	* completer.el: Dead and buried! Replaced by half a page of Common
	Lisp. Thanks Bill Clementson for a motivational and well-deserved
	taunt.

	* swank.lisp (longest-completion): Compute the best partial
	completion for Emacs.

	* slime.el (slime-swank-port-file): Try (temp-directory),
	temporary-file-directory, or "/tmp/", depending on what
	is (f)bound.

2003-11-28  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank-lispworks.lisp (make-dspec-location): Handle logical
	pathnames.  Reported by Alain Picard.

	* swank-sbcl.lisp, swank-cmucl.lisp: Support for output
	redirection to an Emacs buffer via a dedicated network stream.
	Can be enabled with *use-dedicated-output-stream*.

	* swank.lisp (slime-read-string, eval-string): Flush *emacs-io*.
	(eval-in-emacs): New function.

	* slime.el: Support for output from a dedicated socket.
	(slime-open-stream-to-lisp, slime-output-filter): New functions.
	Reorganized REPL code a bit.
	(slime-input-complete-p): Use vanilla forward-sexp, because
	slime-forward-sexp sometimes caused endless loops.
	(slime-disconnect): Close the output-stream-connection if present.
	(slime-handle-oob): A new :%apply event.  Executes arbitrary code;
	useful for bootstrapping.
	(slime-flush-output): New function.
	(slime-symbol-end-pos): Didn't work at all in Emacs20.  Just use
	point until someone commits a proper fix.
	Various uses of display-buffer: The second argument is different in
	XEmacs.
	(interrupt-bubbling-idiot): Reduce the timeout to 5 seconds.
	
2003-11-27  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-swank-port-file): Use `temporary-file-directory'
	instead of hardcoding "/tmp/".

2003-11-27  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank-lispworks.lisp: New backend.
	
	* slime.el (slime-with-output-to-temp-buffer): Save the window
	configuration in a buffer local variable instead on a global
	stack.
	(slime-show-last-output): Behavior customizable with
	slime-show-last-output-function.  Various tweaking for better
	multi-frame support.

	* swank-backend.lisp: List exported symbols explicitly.

	* swank-cmucl.lisp (function-source-location): Better support for
	generic functions.

	* swank.lisp (briefly-describe-symbol-for-emacs): Don't return
	unbound symbols.
	(describe-symbol, describe-function): Support package-qualified
	strings.

	* swank-loader.lisp: *sysdep-pathnames*: Add Lispworks files.
	(compile-files-if-needed-serially): Compile all files in a
	compilation unit.

2003-11-27  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-complete-symbol): Make a bogus alist out of the
	completion set, for compatibility with XEmacs.

	* completer.el: Stolen^Wimported from ILISP version 1.4. This is
	one revision prior to their latest, where they added a (require)
	for some other ILISP code. I backed down a revision to make it
	stand-alone, but this may mean that putting SLIME in the load-path
	before ILISP will break ILISP. So, beware.
	(completer-message): Cut dependency on undefined ilisp constant
	testing for xemacs.

2003-11-27  Zach  <xach@xach.com>

	* swank.lisp (completions): Complete compound symbols (see below).

	* slime.el (slime-complete-symbol): Use `completer' package to
	handle more sophisticated completions. This includes abbreviations
	like "m-v-b" => "multiple-value-bind". It also (somewhat scarily)
	redefines other standard Emacs completion functions with similar
	capabilities. See commentary in completer.erl for details.

2003-11-25  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-make-typeout-frame): New command to create a
	frame where commands can print messages that would otherwise go to
	the echo area.
	(slime-background-message): Function for printing "background"
	messages. Uses the "typeout-frame" if it exists.
	(slime-arglist): Print arglist with `slime-background-message'.
	(slime-message): Use typeout frame if it exists, but only for
	multi-line messages.

2003-11-25  Daniel Barlow  <dan@telent.net>

	* swank-sbcl.lisp: delete big chunk of leftover commented-out 
	code

	* slime.el: arglist command to use slime-read-symbol-name,
	not slime-read-symbol

	* README: Minor updates for currency

2003-11-24  Luke Gorrie  <luke@bluetail.com>

	* swank-backend.lisp (compiler-condition): Removed use of
	:documentation slot option. That is not portable (to CMUCL 18e).

	* swank.lisp (eval-string-in-frame): Fixed symbol-visibility
	problem (thanks Lawrence Mitchell).

	* swank-sbcl.lisp (function-source-location): Use TRUENAME to
	resolve source file name (thanks Lawrence Mitchell).

	* slime.el (slime-goto-source-location): Fixes when finding
	definition by regexp: open the right file (was missed), and
	tweaked regexp to match more 'def' forms - especially
	`defmacro-mundanely' (hyphen wasn't allowed before).

2003-11-23  Luke Gorrie  <luke@bluetail.com>

	* slime.el (sldb-fetch-more-frames): Call swank:backtrace instead
	of (renamed) swank:backtrace-for-emacs.

	* swank-cmucl.lisp, swank-sbcl.lisp, swank-openmcl-lisp: Updated
	to use new debugger interfaces in swank-backend.lisp.

	* swank-backend.lisp (backtrace, eval-in-frame, frame-catch-tags,
	frame-locals, frame-source-location-for-emacs): More interface
	functions.

	* slime.el (slime-goto-source-location): Added optional `align-p'
	argument for :file and :emacs-buffer location types. This is for
	OpenMCL - unlike CMUCL its positions are not character-accurate so
	it needs to be aligned to the beginning of the sexp.
	(slime-connect): Don't delete a random window when *inferior-lisp*
	isn't visible.

	* swank-cmucl.lisp: Tidied up outline-minor-mode structure and
	added comments and docstrings.

	* swank-cmucl.lisp, swank-sbcl.lisp, swank-openmcl-lisp: Updated
	to use new debugger interface in swank-backend.lisp.

	* swank-backend.lisp (call-with-debugging-environment,
	sldb-condition, debugger-info-for-emacs): More callbacks defined.

	* swank.lisp: Tidied up outline-minor-mode structure, added
	comments and docstrings.
	(sldb-loop): Took over the main debugger loop.

	* swank-openmcl.lisp: Updated after refactoring of other backends
	(was broken).

	* slime.el (slime-goto-source-location): Align at beginning of
	sexp after (:file name pos) and (:emacs-buffer buffer pos).

	* swank-sbcl.lisp (describe-symbol-for-emacs): Don't ask for
	(documentation SYM 'class), CLHS says there isn't any 'class
	documentation (and SBCL warns).

	* swank.lisp, swank-cmucl.lisp, swank-sbcl.lisp: Refactored
	interface through swank-backend.lisp for: swank-compile-file,
	swank-compile-string, describe-symbol-for-emacs (apropos),
	macroexpand-all, arglist-string.

	* swank-backend.lisp: New file defining the interface between
	swank.lisp and the swank-*.lisp implementation files.

2003-11-22  Brian Mastenbrook  <bmastenb@cs.indiana.edu>

	* swank.asd: ASDF definition to load "swank-loader.lisp". This is
	useful for starting the Swank server in a separate Lisp and later
	connecting with Emacs. The file includes commentary.

2003-11-22  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-connect): Slightly reordered some window
	operations to ensure that *slime-repl* is popped up after `M-x
	slime-connect'.
	(slime-show-last-output): If the *slime-repl* buffer is already
	visible in any frame, don't change anything.

	* swank.lisp (listener-eval): Format results in *buffer-package*.
	Exporting (CREATE-SWANK-SERVER <port>). This function can be
	called directly to start a swank server, which you can then
	connect to with `M-x slime-connect'. It takes a port number as
	argument, but this can be zero to use a random available port.
	The function always returns the actual port number being used.

2003-11-19  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank.lisp: Better printing off return values.  In the REPL
	buffer we print now every value in a separate line and in the echo
	area separated by a comma.  We also print "; No value" for the
	degenerated case (values).  A new variable *sldb-pprint-frames*
	controls the printing of frames in the debugger. (Thanks Raymond
	Toy for the suggestions.)

	* swank-cmucl.lisp (format-frame-for-emacs): Bind *pretty-print*
	to *sldb-pprint-frames*.

	* slime.el: Window configuration are now saved on a stack, not in
	a single global variable.
	(slime-with-output-to-temp-buffer) We use now our own version of
	with-output-to-temp-buffer.  The default version is painfully
	incompatible between Emacs versions.  The version selects the
	temporary buffer and the behaivor of "q" is now more consistent
	(as suggested by Jan Rychter).
	(slime-connect): Hide the *inferior-lisp-buffer* when we are
	connected.  
	sldb-mode-map: Bind n and p to sldb-down and sldb-up.
	(slime-edit-fdefinition-other-window): New function. Suggested by
	Christian Lynbech.
	
	* swank-loader.lisp (user-init-file): There is now a user init
	file (~/.swank.lisp).  It is loaded after the other files.

2003-11-16  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el: [slime-keys] Override C-c C-r with slime-eval-region
	 (reported by Paolo Amoroso).
	
	* swank-loader.lisp: Compile and load gray stream stuff for SBCL
	and OpenMCL.

	* swank-openmcl.lisp, swank-sbcl.lisp: Import gray stream symbols.
	(without-interrupts*): New function.

	* swank.lisp (send-to-emacs): Protect the write operations by a
	without-interrupts, so that we don't trash the *cl-connection*
	buffer with partially written messages.

	* swank-cmucl.lisp (without-interrupts*): New function.

	* swank-gray.lisp (stream-write-char): Don't flush the buffer on
	newlines.

	* slime.el: Add some docstring.
	(interrupt-bubbling-idiot): New test.
	[slime-keys]:  Don't bind "\C- ".  Problematic on LinuxPPC.

2003-11-15  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el: Some tweaking for better scrolling in the *slime-repl*
	buffer (suggested by Jan Rychter).
	(slime-compile-file): Display the output buffer at the beginning.
	(slime-show-last-output): Include the prompt so that window-point
	is updated properly.
	(slime-with-output-at-eob): Update window-point if the buffer is
	visible.
	(slime-state/event-panic): Include the *slime-events* and
	*cl-connection* buffers in the report.

	* swank-cmucl.lisp (sos/out): Don't flush the buffer on newlines.

2003-11-13  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el: Imititate an "output-mark".  Output from Lisp should
	move point only if point is at the end of the buffer. (Thanks
	William Halliburton for the suggestion.)
	(slime-with-output-at-eob): New function.
	(slime-output-string, slime-repl-maybe-prompt): Use it.

	slime-repl-mode-map: Override "\C-\M-x". 

	An experimental scratch buffer:
	(slime-eval-print-last-expression): New function.
	(slime-scratch-mode-map, slime-scratch-buffer,
	 slime-switch-to-scratch-buffer, slime-scratch): New functions.

	* swank-cmucl.lisp (resolve-location): Emacs buffer positions are
	1 based.  Add 1 to the 0 based file-position.

2003-11-13  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-connect): pop-to-buffer into *slime-repl* when
	we connect.

2003-11-13  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el, swank-cmucl.lisp, swank-sbcl.lisp, swank-openmcl: New
	representation for "source-locations".  Compiler notes have now a
	message, a severity, and a source-location field.  Compiler notes,
	edit-definition, and the debugger all use now the same
	representation for source-location.  CMUCL does the source-path to
	file-position translation at the Lisp side.  This works better
	with reader macros, in particular with backquote.  The SBCL
	backend still does the translation on the Emacs side.  OpenMCL
	support is probably totally broken at the moment
 	
2003-11-13  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-repl-previous-input, slime-repl-next-input):
	When partial input has already been entered, the M-{p,n} REPL
	history commands only match lines that start with the
	already-entered prefix. This is comint-compatible behaviour which
	has been requested. The history commands also skip over line
	identical to the one already entered.
	(slime-complete-maybe-restore-window-confguration): Catch errors,
	so that we don't cause `pre-command-hook' to be killed.
	(slime-truncate-lines): If you set this to nil, slime won't set
	`truncate-lines' in buffers like sldb, apropos, etc.

2003-11-12  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-show-description): XEmacs portability: don't use
	`temp-buffer-show-hook'.
	(slime-inspect): Use `(slime-sexp-at-point)' as default inspection
	value (thanks Jan Rychter).

2003-11-10  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-post-command-hook): Inhibit unless (still) in
	slime-mode. Only call `slime-autodoc-post-command-hook' when
	`slime-autodoc-mode' is non-nil.
	(slime-setup-command-hooks): Use `make-local-hook' instead of
	`make-local-variable'.

2003-11-08  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el: slime-highlight-face: Use the :inherit attribute if
	possible.
	(slime-face-inheritance-possible-p): New function.

	* slime.el (slime-repl-return): Only send the current input to
	Lisp if it is a complete expression, like inferior-slime-return.

	* swank.lisp (completions): Use *buffer-package* if no other
	package is given.

	* slime.el: Remove the non-working face inheriting stuff.
	Hardcode colors for slime-highlight-face and specify the :inherit
	attribute for slime-repl-output-face.  So Emacs21 will do the
	right thing and the others get at least a customizable face.

	* slime.el (slime-buffer-package): Try to find be the
	package name before resorting to slime-buffer-package.  Return nil
	and not "CL-USER" if the package cannot be determined.
	(slime-goto-location): Insert notes with a source path, but
	without filename or buffername, at point.  This can happen for
	warnings during macro expansion. (The macro expander is a
	interpreted function and doesn't have a filename or buffername.)
	(slime-show-note): Display 2 double quotes "" in the echo area for
	zero length messages.  SERIES tends to signal warnings with zero
	length messages.
	(slime-print-apropos): Add support for alien types.

	* swank-cmucl.lisp (briefly-describe-symbol-for-emacs): Add
	support for alien types.
	(source-path-file-position): Read the entire expression with a
	special readtable.  The readtable records source positions for
	each sub-expression in a hashtable.  Extract the sub-expression
	for the source path from the read object and lookup the
	sub-expression in the hashtable to find its source position.

	* swank-sbcl.lisp (swank-macroexpand-all): Implemented.

2003-11-06  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-autodoc-mode): When non-nil, display the
	argument list for the function-call near point each time the point
	moves in a slime-mode buffer. This is a first-cut; more useful
	context-sensitive help to follow (e.g. looking up variable
	documentation).
	(slime-autodoc-cache-type): Cache policy "autodoc" documentation:
	either nil (no caching), 'last (the default - cache most recent
	only), or 'all (cache everything on symbol plists forever).

	* slime.el: Convenience macros:
	(when-bind (var exp) &rest body)
	  => (let ((var exp)) (when var . body))
	(with-lexical-bindings (var1 ...) . body)
	  => (lexical-let ((var1 var1) ...) . body)

	* slime.el (slime, slime-lisp-package): Reset `slime-lisp-package'
	(the REPL package) when reconnecting.
	(slime-buffer-package): Return `slime-lisp-package' when the
	major-mode is `slime-repl-mode'.

2003-11-04  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el (slime-read-string-state): Add support for evaluation
	requests.
	(slime-repl-read-break): New command.
	alternative.
	slime-keys: XEmacs cannot rebind C-c C-g.  Use C-c C-b as an
	alternative.
	(slime-selector): XEmacs has no prompt argument for read-char.
	(slime-underline-color, slime-face-attributes): Make face
	definitions compatible with XEmacs and Emacs20.
	(slime-disconnect): Delete the buffer of the socket.
	(slime-net-connect): Prefix the connection buffer name with a
	space to avoid accidental deletion.

	* swank.lisp (slime-read-string): Send a :read-aborted event for
	non-local exits.
	(case-convert): Handle :invert case better.

2003-11-03  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el (slime-display-message-or-view,
	slime-remove-message-window): Display too long lines in a new
	window.  Add a temporary pre-command-hook to remove the multiline
	window before the next command is executed.

	(slime-complete-symbol): Save the window configuration before
	displaying the completions and try to restore it later.  The
	configuration is restored when: (a) the completion is unique (b) there
	are no completion.  It is also possible to delay the restoration until
	(c) certain characters, e.g, space or a closing paren, are inserted.

	(slime-selector): Don't abort when an unkown character is pressed;
	display a message and continue.  Similiar for ?\?.  Add a selector for
	the *sldb* buffer.

	(slbd-hook, sldb-xemacs-post-command-hook): Emulate Emacs'
	point-entered text property with a post-command hook.

	* swank.lisp (case-convert, find-symbol-designator): New
	functions.

	* swank-cmucl.lisp, swank-openmcl.lisp, swank-sbcl.lisp
	(arglist-string): Don't intern the function name.  Use
	find-symbol-designator instead.

2003-11-03  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-display-buffer-region): Hacked to fix completely
	inexplicable XEmacs problems.

2003-11-2  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* null-swank-impl.lisp, swank-cmucl.lisp, swank-openmcl.lisp,
	swank.lisp: Input redirection works now on the line level, like a
	tty.  Output streams are now line buffered.  We no longer compute
	the backtrace-length.

	* slime.el:
	(slime-repl-read-mode, slime-repl-read-string, slime-repl-return,
	slime-repl-send-string, slime-read-string-state,
	slime-activate-state): Reorganize input redirection.  We no longer
	work on the character level but on a line or region; more like a
	terminal.  This works better, because REPLs and debuggers are
	usually written with a line buffering tty in mind.
	(sldb-backtrace-length, slime-debugging-state,
	slime-evaluating-state, sldb-setup, sldb-mode, sldb-insert-frames,
	sldb-fetch-more-frames): Don't use backtrace-length.  Computing
	the length of the backtrace is (somewhat strangely) an expensive
	operation in CMUCL, e.g., it takes >30 seconds to compute the
	length when the yellow zone stack guard is hit.

2003-11-02  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-log-event): Added a *slime-events* buffer
	recording all state machine events. The buffer uses hideshow-mode
	to fold messages down to single lines.
	(slime-show-source-location): Bugfix: only create source-highlight
	overlay if the source was actually located.
	(slime-selector): Renamed from `slime-select' because that
	function name was already in use. Ooops!

	* swank.lisp (eval-string): force-output on *slime-output* before
	returning the result. This somewhat works around some trouble
	where output printed by lisp is being buffered too long.

	* slime.el (slime-lisp-package-translations): Association list of
	preferred package nicknames, for the REPL prompt. By default maps
	COMMON-LISP->CL and COMMON-LISP-USER->CL-USER.

2003-11-01  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-select): Added an extensible "Select" command,
	which I gather is a LispM/Martin-Cracauer knock-off. When invoked,
	the select command reads a single character and uses that to
	decide which buffer to switch to. New characters can be defined,
	and the currently availables ones can be seen with '?'. I have not
	assigned a key to Select, because it seems like a command that
	should have a global binding. I would suggest `C-c s'.

	* swank.lisp (*slime-features*): Variable remembering the FEATURES
	list.
	(sync-state-to-emacs): Update Emacs about any state changes -
	currently this just means changes to the FEATURES list.
	(eval-string): Call `sync-state-to-emacs' before sending result.
	(eval-region): With optional PACKAGE-UPDATE-P, if the evaluation
	changes the current package, tell Emacs about the new package.
	(listener-eval): Tell `eval-region' to notify Emacs of package
	changes, so that e.g. (in-package :swank) does the right thing
	when evaluated in the REPL.

	* slime.el (slime-repl-output-face, slime-repl-input-face): Face
	definitions for output printed by Lisp and for previous REPL user
	inputs, respectively. Defaulting the input face to bold rather
	than underline, because it looks better on multi-line input.
	(slime-handle-oob): Two new out-of-band messages
	(:new-features FEATURES) and (:new-package PACKAGE-NAME). These
	are used for Lisp to tell Emacs about changes to *FEATURES* and
	*PACKAGE* when appropriate.
	(slime-same-line-p): Better implementation (does what the name
	suggests).
	(slime-lisp-package): New variable keeping track of *PACKAGE* in
	Lisp -- or at least, the package to use for the REPL.
	(slime-repl-insert-prompt): The prompt now includes the package
	name.
	(slime-repl-bol): C-a in the REPL now stops at the prompt.
	(slime-repl-closing-return): C-RET & C-M-m now close all open
	lists and then send input in REPL.
	(slime-repl-newline-and-indent): C-j in REPL is now better with
	indentation (won't get confused by unmatched quotes etc appearing
	before the prompt).

2003-11-1  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el (slime-debugging-state): Save the window configuration
	in a state variable.  
	sldb-saved-window-configuration: Removed.
	(slime-repl-mode): Use conservative scrolling.
	(slime-repl-insert-prompt): Set window-point after the prompt.
	(slime-repl-add-to-input-history): Don't add subsequent duplicates to
	the history.

	* swank.lisp (slime-read-char): Flush the output before reading.
	(listener-eval): Like eval region but set reader variables (*, **,
	*** etc.)

	* swank-openmcl.lisp, swank-sbcl.lisp: Implement stream-line-column.

	* swank-cmucl.lisp (slime-input-stream-misc-ops): Renamed from
	slime-input-stream-misc.

2003-10-31  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-repl-mode-map): Bound `slime-interrupt' on both
	C-c C-c and C-c C-g.

	* swank.lisp (interactive-eval): Evaluate in *buffer-package*.

	* slime.el: Tweaked debugger window management somewhat: the
	window configuration is saved when the debugger is first entered
	and then restored when the idle state is reached.

2003-10-31  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el: (slime-repl-read-mode, slime-repl-read-xxx): New minor
	mode for stream character based input to Lisp.

	* swank.lisp: *read-input-catch-tag*, take-input, slime-read-char:
	Moved here from swank-cmucl.lisp.
	(defslimefun, defslimefun-unimplemented): Move macro definitions to
	the beginning of the file.

	* swank-cmucl.lisp: (slime-input-stream, slime-input-stream-read-char,
	lime-input-stream-misc): Character input stream from Emacs.
	(slime-input-stream/n-bin): Removed.

	* swank-openmcl.lisp, swank-sbcl.lisp: Gray stream based input
	redirection from Emacs.
	
2003-10-29  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el:
	Beginnings of a REPL-mode.
	Minor debugger cleanups.

	* swank.lisp:
	slime-read-error: New condition.
	(read-next-form): Re-signal the conditions as slime-read-errors.  And
	check the result of read-sequence (i.e. detect CMUCL's read-sequence
	bug).
	(sldb-continue, throw-to-toplevel): Was more or less the same in all
	backends.

	* swank-openmcl.lisp, swank-sbcl.lisp, swank-cmucl.lisp:
	(serve-request): Handle slime-read-errors and bind a
	slime-toplevel catcher.

	* swank-cmucl.lisp:
	(sldb-loop): Flush output at the beginning.
	(inspect-in-frame): New function.
	(frame-locals): Don't send the validity indicator across wire.  Too
	cmucl specific.

2003-10-29  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-net-sentinel): Only show a message about
	disconnection if the inferior-lisp is still running.
	(slime-interrupt, slime-quit): Only send the quit/interrupt
	message to Lisp if it is in fact evaluating something for us. This
	fixes a protocol bug reported by Paolo Amoroso.  Added (require
	'pp).

2003-10-28  James Bielman  <jamesjb@jamesjb.com>

	* null-swank-impl.lisp: New file.

	* swank-openmcl.lisp: Pre-refactoring updates to the OpenMCL backend:
	(map-backtrace): Renamed from DO-BACKTRACE.
	(frame-source-location-for-emacs): New function.
	(function-source-location-for-emacs): New function,

	* swank-openmcl.lisp: Docstring updates/additions.

2003-10-25  Luke Gorrie  <luke@bluetail.com>

	* Everywhere: Changed the connection setup to use a dynamic
	collision-free TCP port. The new protocol is this:
	
	  Emacs calls (swank:start-server FILENAME) via the
	    listener. FILENAME is /tmp/slime.${emacspid}
	  Lisp starts a TCP server on a dynamic available port and writes
	    the port number it gets to FILENAME.
	  Emacs asynchronously polls for FILENAME's creation. When it
	    exists, Emacs reads the port number, deletes the file, and makes
	    the connection.
	
	The advantage is that you can run multiple Emacsen each with an
	inferior lisp, and the port numbers will never collide and Emacs
	will always connect to the right lisp.

	All backends are updated, but only CMUCL and SBCL are
	tested. Therefore, OpenMCL is almost certainly broken just now.
	
	* slime.el (inferior-slime-closing-return): New command that
	closes all open lists and sends the result to Lisp. Bound to C-RET
	and (for people who use C-m for RET) C-M-m.
	(inferior-slime-indent-line): Improved indentation in the inferior
	list buffer.

2003-10-24  Luke Gorrie  <luke@bluetail.com>

	* slime.el (inferior-slime-return): Command bound to RET in
	inferior-slime-mode: only send the current input to Lisp if it is
	a complete expression (or prefix argument is given). Two reasons:
	it makes the input history contain complete expressions, and it
	lets us nicely indent multiple-line inputs. (Thanks Raymond Toy
	for the suggestions.)

2003-10-23  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-maybe-start-lisp): Restart inferior-lisp if the
	process has died.

	* swank-sbcl.lisp (accept-connection): Use a character stream to
	match swank.lisp.

2003-10-22  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank-cmucl.lisp (setup-request-handler): Create a character
	stream.
	(read-next-form): Removed.

	* swank.lisp (read-next-form, send-to-emacs): Assume *emacs-io* is
	a character stream. Add the necessary char-code/code-char
	conversions.

	* slime.el: slime-keys: Add :sldb keywords for keys useful in the
	debugger.
	(slime-init-keymaps): Allow allow :sldb keywords.

	inferior-lisp-mode-hook: Display the inf-lisp buffer if there is
	some output.

	(slime-process-available-input): Start a timer to process any
	remaining input.
	(slime-dispatch-event): The timer should take care of any lost
	input. So don't process the available input here.  Remove the
	process-input argument.
	(slime-push-state, slime-pop-state, slime-activate-state,
	 slime-idle-state, slime-evaluating-state): Update callers.
	(slime-debugging-state): Remove the unwind-protect in the
	:debug-return clause.  Should not be necessary.

	sldb-mode-map: Define more slime-mode keys.

	(slime-time<, slime-time-add): Removed. Emacs-21 has equivalent time
	functions.
	(slime-sync-state-stack): Use Emacs-21 time-date functions.
	(seconds-to-time, time-less-p, time-add): Compatibility defuns.

2003-10-22  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime): With a prefix argument, prompt for the port
	number to use for communication with Lisp. This is remembered for
	future connections.

2003-10-22  Hannu Koivisto  <azure@iki.fi>

	* slime.el (slime-space): Now allows one to insert several spaces
	with a prefix argument.

2003-10-21  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-space): Don't give an error when not connected,
	to avoid feeping.

	* swank-sbcl.lisp (swank-compile-string): Include only one
	:SOURCE-PATH attribute in the plist, and replace the front element
	with a 0 (fixes a problem probably due to recent hacks to the
	elisp source-path lookups).

	* slime.el (inferior-slime-mode): New minor mode for use with
	`inferior-lisp-mode'. Defines a subset of the `slime-mode' keys
	which don't clash with comint (e.g. doesn't bind M-{p,n}).
	(slime-keys): List of keybinding specifications.
	(slime-find-buffer-package): If we don't find the "(in-package" by
	searching backwards, then try forwards too.

	* swank.lisp (completions): Fixed semantics: should now consider
	only/all completions that would not cause a read-error due to
	symbol visibility. Also avoiding duplicates and sorting on
	symbol-name.

2003-10-20  Luke Gorrie  <luke@bluetail.com>

	* swank.lisp (completions): Slight change of semantics: when a
	prefix-designator is package-qualified, like "swank:", only match
	symbols whose home-package matches the one given - ignore
	inherited symbols.

	* slime.el: Updated test suite to work with the different backends:
	(find-definition): Lookup definitions in swank.lisp.
	(arglist): Lookup arglists of functions in swank.lisp.

2003-10-20  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el (interactive-eval): Make test case independent of
	*print-case*.

2003-10-20  Luke Gorrie  <luke@bluetail.com>

	* swank-cmucl.lisp (clear-xref-info): Conditionalised
	xref:*who-is-called* and xref:*who-macroexpands* with
	#+CMU19. This makes SLIME compatible with CMUCL 18e, but also
	disables the `who-macroexpands' command in any CMUCL version that
	doesn't have the "19A" feature (which does break the command in
	some snapshot builds that can actually support it).

2003-10-20  Daniel Barlow  <dan@telent.net>

	* swank.lisp (*notes-database*): tyop fix

	* swank-sbcl.lisp (throw-to-toplevel): select TOPLEVEL restart
	instead of throwing to a catch that no longer exists

	* slime.el: change some strings containing 'CMUCL' to more 
        backend-agnostic phrases

2003-10-19  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el, swank-cmucl.lisp, swank.lisp: First shoot at input
	redirection.

	* swank-sbcl.lisp, swank-openmcl.lisp: Bind *slime-input* and
	*slime-io* to dummy values.

2003-10-19  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime): Connection setup is now asynchronous, with
	retrying on a timer. This makes it possible to bring the server up
	by hand while debugging. `M-x slime' while already connected will
	cause the old connection to be dropped and a new one established.
	(slime-disconnect): New command to disconnect from Swank, or
	cancel asynchronous connection attempts when not yet connected.
	(slime-state/event-panic): Illegal events in the communication
	state machine now trigger a general panic that disconnects from
	Lisp, and displays a message describing what has happened. This is
	a bug situation.
	(slime-connect): Print a message during connection attempts unless
	the minibuffer is active (it's annoying to get messages while
	trying to enter commands).

2003-10-18  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el: Fix some bugs in the state machine and be a bit more
	careful when processing pending input.
	(slime-compile-region): New command.
	Some more tests.
	
2003-10-17  James Bielman  <jamesjb@jamesjb.com>

	* .cvsignore: Add OpenMCL and SBCL fasl file extensions.

	* swank-openmcl.lisp (who-calls): Fix bug where we would try to
	take the TRUENAME of NIL when source information isn't available
	for a caller.
	(backtrace-for-emacs): Clean up the backtrace code a bit in 
	preparation for implementing FRAME-LOCALS.
	(frame-catch-tags): Implement a stub version of this.
	(frame-locals): Implemented fully for OpenMCL.

	* swank-loader.lisp (compile-files-if-needed-serially): Be a little
	more verbose when compiling files.

2003-10-17  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank.lisp, swank-sbcl.lisp, swank-openmcl.lisp,
	swank-cmucl.lisp: Move more stuff to swank.lisp.
	
2003-10-17  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-post-command-hook): Check that we are connected
	before trying to process input.
	(slime-net-connect): Handle `network-error' condition for XEmacs
	21.5. (Thanks Raymond Toy.)

	* swank-sbcl.lisp: Report style-warnings separately from notes
	(patch from Christophe Rhodes). Use REQUIRE to load sb-introspect
	instead of loading the source file (requires the sb-introspect
	library to be installed, which doesn't yet happen in the
	sourceforge-lagged SBCL anoncvs, but does in the real one).

	* slime.el (slime-style-warning-face): Added style-warnings, which
	are between a warning and a note in severity. (Patch from
	Christophe Rhodes).

	* test.sh: When the test fails to complete, print "crashed"
	instead of reporting nonsense.

2003-10-17  James Bielman  <jamesjb@jamesjb.com>

	* swank.lisp (apropos-symbols): Change back to using the standard
	2-argument APROPOS-LIST and check symbols explicitly when
	EXTERNAL-ONLY is true.
	Move loading of sys-dependent backend code into 'swank-loader'.

	* swank-sbcl.lisp: Moved declarations of *PREVIOUS-COMPILER-CONDITION*
	into 'swank.lisp' to kill warnings about undefined variables.

	* swank-openmcl.lisp (handle-compiler-warning): Use source position
	instead of function name for warning locations.
	(swank-compile-string): Compile into a temporary file instead of
	using COMPILE so finding warning positions works when using C-c C-c.
	(compute-backtrace): Don't display frames without a function.
	(apropos-list-for-emacs): Implement APROPOS.
	(who-calls): Implement WHO-CALLS.
	(completions): Implement COMPLETIONS.
	Use NIL instead of zero so FRESH-LINE does the right thing.

	* slime.el (slime-maybe-compile-swank): Removed function---compile
	the backend using 'swank-loader.lisp' instead.
	(slime-backend): Changed default backend to 'slime-loader'.
	(slime-lisp-binary-extension): Deleted as this is no longer needed.

	* swank-loader.lisp: New file.

2003-10-17  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-net-connect): Check that
	`set-process-coding-system' is fbound before calling it. This is
	needed in the XEmacs I built from sources.

2003-10-17  Daniel Barlow  <dan@telent.net>

	* swank-sbcl.lisp: Transplanted Helmut's serve-event server to
	replace the existing thread-using server.  SLIME now has no 
	dependency on SB-THREAD

	* slime.el (slime-find-buffer-package): handle errors from (read)
	for the case where the buffer ends before the in-package form does
	(slime-set-package): insert missing comma
	(slime-goto-source-location): sbcl has a disagreement with emacs
	over the meaning of a character position.  Level up with
	C-M-f C-M-b

	* assorted typo fixes

2003-10-16  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-forward-source-path): Improved somewhat. Seems
	to work for all common cases except backquote. Backquote is
	tricky, because the source-paths are based on the reader's
	expansion, e.g.:
	* (let ((*print-pretty* nil))
	    (print (read-from-string "`(a ,@(b c) d)")))
	  -->
	  (COMMON-LISP::BACKQ-CONS (QUOTE A)
	                           (COMMON-LISP::BACKQ-APPEND (B C)
			                                      (QUOTE (D))))
	Must investigate whether we need to write a hairy
	backquote-traversing state machine or whether this is something
	that could be fixed in CMUCL.

	* swank*.lisp (with-trapping-compiler-notes): This macro is now
	defined here, and expands to a call to the backend-defined
	`call-trapping-compiler-notes' with the body wrapped in a
	lambda. This is to avoid swank.lisp referring to macros in the
	backends -- it gets compiled first so it thinks they're functions.

	* slime.el (slime-swank-connection-retries): New default value is
	`nil', which means unlimited retries (until user aborts). Retry
	interval also reduced from once per second to four times per
	second.

2003-10-16  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank-cmucl.lisp, swank.lisp: Fix CMUCL support. 

2003-10-15  Daniel Barlow  <dan@telent.net>

	* swank.lisp: rearrange the backends.  rename swank.lisp to
	swank-cmucl.lisp, then create new swank.lisp which loads an
	appropriate backend according to *features*.  Next up, 
	identify common functions in the backends and move them
	into swank.lisp

2003-10-15  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* slime.el: Inspector support.  list-callers, list-callees
	implemented without xref.

	* swank.lisp: Lisp side for inspector and list-callers,
	list-calees.  Better fdefinition finding for struct-accessors.


2003-10-15  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-point-moves-p): Macro for executing subforms and
	returning true if they move the point.

	* test.sh: New file to run the test suite in batch-mode. Will need
	a little extending to allow configuring the right variables to
	work with non-CMUCL backends.

	* slime.el: Set `indent-tabs-mode' to nil. This makes diffs look
	better.
	(slime-start-swank-server): Now passing the port number to
	SWANK:START-SERVER.
	(slime-evaluating-state): Debugging synchronous evaluations with
	recursive edits now works.
	(slime-forward-sexp): Added support for #|...|# reader comments.
	(sldb-hook): New hook for entry to the debugger (used for the test
	suite).
	(slime-run-tests): Reworked the testing framework. Now presents
	results in an outline-mode buffer, with only the subtrees
	containing failed tests expanded initially.
	(slime-check): Check-name can now be a string or
	format-control. (Test cases have been updated to take advantage of
	this.)
	(compile-defun): This test case now works for the case containing
	#|..|#
	(async-eval-debugging): New test case for recursively debugging
	asynchronous evaluation.

2003-10-15  Daniel Barlow  <dan@telent.net>

	* README.sbcl: new file

	* README: update for new backends, change of hosting provider

	* swank-sbcl.lisp: new file.
	New SWANK backend for Steel Bank Common Lisp, adapted from
	swank.lisp with bits of swank-openmcl.lisp

2003-10-12  Daniel Barlow  <dan@telent.net>

	* slime.el (sldb-mode-map): add mouse-2 clickability for areas
	in sldb buffers covered by the sldb-default-action property:
	restarts can now be mouse-activated

2003-09-28  James Bielman  <jamesjb@jamesjb.com>

	* swank-openmcl.lisp: New file, a Slime backend for OpenMCL 0.14.x.
	(condition-function-name): Figure out the name of methods correctly
	instead of passing a list to Emacs.

	* slime.el (slime-goto-location): Try to position notes based on
	some (questionable) regex searching if the :FUNCTION-NAME property
	is set.  Used in the OpenMCL backend which does not support source
	paths.

2003-09-29  Luke Gorrie  <luke@bluetail.com>

	* slime.el: Fairly major hacking.
	Rewrote the evaluation mechanics: similar design but some macros
	to make it look more like a push-down automaton (which it really
	was!). Debugging Lisp no longer uses recursive edits, partly as a
	side-effect and partly to see if it's better this way.
	Removed the asynchronous-communication test cases that tested
	something we decided not to do.
	(slime-eval-string-async): Give a meaningful error message when
	trying to make a request while already busy.
	(slime-lisp-binary-extension): Uh oh, time to start taking out
	gratuitous CMUCL-isms. This variable renamed from
	`slime-cmucl-binary-extension'.
	(slime-backend): Name of the Lisp backend file, defaulting to
	"swank", but can be set to e.g. "swank-openmcl".

	* swank.lisp: Minor protocol changes to accomodate slime.el's
	changes above.

2003-09-28  Helmut Eller  <e9626484@stud3.tuwien.ac.at>

	* swank.lisp 
	(getpid, set-package, set-default-directory): New functions.
	(slime-out-misc): Don't send empty strings.
	(*redirect-output*, read-from-emacs): A new switch to turn output
	redirection off. Useful for debugging.
	(interactive-eval, interactive-eval-region, pprint-eval,
	re-evaluate-defvar): Bind *package* to *buffer-package*.
	(with-trapping-compilation-notes): Add a dummy argument for better
	indentation.
	(measure-time-intervall, call-with-compilation-hooks): Measure
	compilation time.
	(frame-locals): Use di::debug-function-debug-variables instead of
	di:ambiguous-debug-variables. Don't access non-valid variables.

	* slime.el
	(slime-display-message-or-view): Delete old multi-line windows.
	(slime-read-package-name): Added an optional initial-value
	argument.  slime-pid: New variable.
	(slime-init-dispatcher): Initialize slime-pid.
	(slime-send-sigint): Use slime-pid instead of inferior-lisp-proc.
	(slime-eval): Accept debug-condition messages.
	(slime-output-buffer): Turn slime-mode on.
	(slime-switch-to-output-buffer): New command.  Bound to C-c C-z.
	(slime-show-note-counts): Display compilation time.
	(slime-untrace-all, slime-set-package, slime-set-default-directory
	slime-sync-package-and-default-directory): New commands.
	(slime-princ-locals): Don't access non-valid variables.  This may
	cause segfaults and severely confuse CMUCL.
	(slime-define-keys): New macro.

2003-09-28  Luke Gorrie  <luke@bluetail.com>

	* swank.lisp (create-swank-server): Bind the listen-socket on the
	loopback interface by default, so that remote machines can't
	connect to the Swank server.

2003-09-27  Luke Gorrie  <luke@bluetail.com>

	* swank.lisp (with-trapping-compilation-notes): New macro for
	bindings the handlers to record compiler notes. Now being used in
	`compile-string', which I had broken when removing the compilation
	hook.

	* slime.el (slime-function-called-at-point): Rewritten to work
	better. Now considers "((foo ..." _not_ to be a function call to
	foo because of the double ('s - this will keep it from misfiring
	in e.g. LET bindings.
	(def-slime-test): All tests now being with (slime-sync). This
	fixes some accidental/bogus test failures.

	* swank.lisp (handle-notification-condition): Rewrote
	compiler-note collection. Now it uses lower-level condition
	handlers instead of c:*compiler-notification-function*. This way
	the error messages are tailored to omit redundant information,
	like the filename and original source text (which are displayed
	and highlighted in Emacs already). Much nicer.
	(sort-contexts-by-source-path): Now sorting xref results by
	lexical source-path order, so that you're always jumping in the
	same direction.
	(*debug-definition-finding*): New variable. You can set this to
	true if you want to be popped into the debugger when M-. fails to
	find a definition (for debugging the
	definition-finding). Otherwise it reports the error to Emacs as a
	message, like "Error: SETQ is a special form."

	* slime.el (slime-fetch-features-list): New command to fetch the
	*FEATURES* list from Lisp and store it away. This is done
	automatically upon connection, but can also be called manually to
	update.
	(slime-forward-reader-conditional): Now does the right things with
	reader-conditionals (#+ and #-) based on the Lisp features.

2003-09-26  Luke Gorrie  <luke@bluetail.com>

	* slime.el (sldb-setup): Setting `truncate-lines' to t in the
	debug buffer. I like having the backtrace take strictly one line
	per frame, since otherwise a few ugly arguments (e.g. streams) can
	chew up a lot of space. (Can make this a configurable on request
	if tastes differ :-)

	* swank.lisp: Did a little defensive programming so that asking
	for the definition of an unbound function will return nil to Emacs
	instead of entering the debugger.
	(format-frame-for-emacs): Binding *PRETTY-PRINT* to nil when
	formatting frames (due to truncate-lines change above).

2003-09-24  Helmut Eller <e9626484@stud3.tuwien.ac.at>

	* swank.lisp:
	Support for stream redirection.
	slime-output-stream: New structure.
	(slime-out-misc): New function.
	*slime-output*: New variable.
	(read-from-emacs): Redirect output to *slime-output*.
	(read-form): Bind *package* inside the standard-io-syntax macro.
	(eval-string): Read the string with read-form.
	(completions): Support for keyword completion.

	* slime.el (slime-process-available-input, slime-eval): Rewritten
	once again.  Don't use unwind-protect anymore. Didn't work
	properly when the Lisp side aborted due to too many debug
	levels. "Continuing" from the Emacs debugger aborts one level on
	the Lisp side. "Quitting" from the Emacs debugger quits the Lisp
	side too. Increase stack sizes before entering the recursive edit.
	(slime-eval-async-state, slime-eval, sldb-state): Support for stream
	output.
	slime-last-output-start: New variable.
	(slime-output-buffer, slime-output-buffer-position,
	 slime-insert-transcript-delimiter, slime-show-last-output,
	 slime-output-string): New functions.
	(slime-show-evaluation-result,
	slime-show-evaluation-result-continuation): Use them.
	(slime-use-inf-lisp-p, slime-insert-transcript-delimiter,
	 slime-inferior-lisp-marker-position,
	 slime-inferior-lisp-show-last-output): Deleted.
	(slime-use-tty-debugger, slime-debugger-hook,
	slime-enter-tty-debugger, slime-tty-debugger-state): Deleted. Removed
	tty debugger support.
	(def-sldb-invoke-restart): Renamed.
	(define-sldb-invoke-restart-key, define-sldb-invoke-restart-keys):
	Version without eval.
	(defun-if-undefined): New macro.
	Many indentation fixes.

2003-09-23  Helmut Eller <e9626484@stud3.tuwien.ac.at>

	* swank.lisp (completions):
	Moved most of the completion code to Lisp.
	(string-prefix-p): Be case insensitive.

	* slime.el:
	Make sure define-minor-mode is defined before we use it.
	(slime-completing-read-internal, slime-completing-read-symbol-name,
	slime-read-from-minibuffer, slime-completions, slime-complete-symbol):
	Support for reading symbols and expressions with completion.
	(slime-read-symbol-name): New function.
	(slime-read-symbol): Use it.
	(slime-read-package-name): Case insensitive completion.

	(slime-edit-symbol-fdefinition, slime-edit-fdefinition): Rename
	slime-edit-symbol-fdefinition to slime-edit-fdefinition.

2003-09-23  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-show-xrefs): Improved the xrefs buffer, now
	using a custom minor mode.
	(slime-next-location): This function goes to the next "something"
	by funcall'ing slime-next-location-function. Currently that
	variable is set by xref commands like who-calls to go to the next
	matching reference. In future it can also be used to go to the
	next function definition for a generic-function-understanding
	version of edit-fdefinition. Bound to C-M-. and C-c C-SPC, until
	we see which binding is better.

2003-09-22  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-symbol-at-point): Now returns a symbol, as the
	name suggests.
	(slime-symbol-name-at-point): This one returns a string.
	(slime-read-symbol): New function for taking the symbol at point,
	or prompting if there isn't one.
	(slime-edit-fdefinition): Now uses looks up the symbol at point,
	not the function being called at point.

	* swank.lisp (who-calls, who-references, who-binds, who-sets,
	who-macroexpands): New function.
	(present-symbol-before-p): Use `*buffer-package*' when checking
	accessibility of symbols.

	* slime.el (slime-restore-window-configuration): New command to
	put the Emacs window configuration back the way it was before
	SLIME last changed it.
	(slime-who-calls, etc): Very basic WHO-{CALLS,..} support. Not
	finished, wrestling around trying to make `view-mode' or
	`help-mode' help me (I just want to hijack RET and C-m). Bound to
	"C-c C-w ...".

2003-09-21  Luke Gorrie  <luke@bluetail.com>

	* slime.el: Rearranged the `outline-mode' structure slightly.
	(slime-check-connected): Using new function to give a helpful
	error message if you try to use commands before establishing a
	connection to CMUCL.
	(sldb-mode): Keys 0-9 are now shortcuts to invoke restarts.

	* README, swank.el: Updated commentary.

2003-09-20  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-choose-overlay-region): Tweaked overlay
	placement.

	* swank.lisp (handle-notification): Skipping null
	notifications. For some reason CMUCL occasionally calls us with
	NIL as each argument.

2003-09-19  Helmut Eller <e9626484@stud3.tuwien.ac.at>
	
	* slime.el (slime-connect): Propose default values when called
	interactively.
	(slime-process-available-input): If possible, use while rather than
	recursion.
	(slime-compilation-finished-continuation): New function.
	(slime-compile-file, slime-compile-defun): Use it.
	(slime-forward-source-path): Id an error is encounter move back to the
	last valid point.
	(slime-eval-region): Use append COND.  Send the entire string to the
	Lisp side and read&evaluate it there.
	(slime-eval-buffer): New function.
	(sldb-sugar-move, sldb-details-up, sldb-details-down): New functions.
	
	* swank.lisp (interactive-eval-region): New function.
	(re-evaluate-defvar): New function.
	(compile-defun): Install handler for compiler-errors.
	(function-first-code-location): Simplified.
	
2003-09-17  Helmut Eller <e9626484@stud3.tuwien.ac.at>
	
	* slime.el (slime-apropos-all): New command, bound to C-c M-a.
	(slime-eval): Simplified.
	(swank:arglist-string): Send a string and not a symbol.  It easier
	to package related thins in CL.
	(slime-edit-symbol-fdefinition): Prompt when called with
	prefix-argument.
	(slime-eval-region): New function.
	(slime-load-file): New function.
	(slime-show-description): Set slime minor mode in Help buffer.

	* swank.lisp: (read-string, from-string): Renamed read-string to
	from-string.
	(to-string) New function.
	(arglist-string): Catch reader errors.
	(sldb-loop): Also bind *readstrable*.

	
2003-09-16  Helmut Eller <e9626484@stud3.tuwien.ac.at>

	* slime.el (slime-toggle-trace-fdefinition): New command.
	(slime-symbol-at-point, slime-sexp-at-point): New utility functions.
	(slime-edit-symbol-fdefinition): Similar to slime-edit-fdefinition but
	uses swank:function-source-location-for-emacs.
	(slime-goto-source-location): New function.
	(sldb-show-source): Use it.
	(slime-read-package-name): Completing read for package names.
	(slime-apropos): Use it.

	* swank.lisp (function-source-location,
	function-source-location-for-emacs): New functions to extract
	source locations from compiled code.  For struct-accessors we try
	to find the source location of the corresponding constructor.
	(list-all-package-names): New function.
	(toggle-trace-fdefinition, tracedp): New functions.

2003-09-15  Helmut Eller <e9626484@stud3.tuwien.ac.at>

	* slime.el: Moved many CL fragments from slime.el to swank.lisp.
	(slime-compile-file, slime-compile-defun, slime-goto-location):
	Compiler notes are now represented with a property list.  To find
	the source expression first move to the file offset of the
	top-level form and then use the source path to find the
	expression.  This should avoid many reader issues.  For
	compile-defun store the start position of the top-level expression
	from the buffer in the compiler notes and use that to locate error
	messages.  Add error overlays for notes without context to the
	first available expression.

	* swank.lisp: Moved many CL fragments from slime.el to swank.lisp.
	(defslimefun): New macro.

2003-09-15  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-setup-command-hooks): Removed post-command-hook
	that was used for cleaning up input that was unprocessed due to an
	error breaking out of the process filter. This is now handled by
	an `unwind-protect' in the filter.

	* swank.lisp (apropos-list-for-emacs): Hacked the apropos listing
	to accept more options and to specially sort results.

	* slime.el (slime-net-send): Added newlines to messages over the
	wire. This makes the protocol nicely readable in Ethereal.
	(slime-sync): New function for blocking until asynchronous
	requests are complete.
	(slime-apropos): Hacked the apropos command: by default, only
	external symbols are shown. With a prefix argument you have the
	option to include internal symbols and to specify a package.
	(slime-run-tests): Extended the test suite. Use `M-x
	slime-run-tests' to run it.

2003-09-14  Luke Gorrie  <luke@bluetail.com>

	* slime.el, swank.lisp: Added the debugger written by Helmut.

	* cmucl-wire.el: Removed. The WIRE communication protocol has been
	replaced by a simple custom TCP protocol based on READ/PRIN1 to
	send sexps as ascii text. This simplifies the code, makes the
	protocol nicely debugable with ethereal, and should ease porting
	to other Lisps. Incremented TCP port number to 4005 in honor of
	the new protocol.
	
	In addition, Lisp now always uses *print-case* of :DOWNCASE when
	preparing sexps for Emacs. This is in reaction to a bug with Emacs
	reading the empty list as `NIL' instead of `nil'.

	* slime.el (slime-net-connect): The Emacs end of the new
	communication protocol.

	* swank.lisp (create-swank-server): The Lisp end of the new
	communication protocol.

2003-09-11  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-mode): Added Helmut's commands to the mode
	description.
	(slime-show-apropos): Setting `truncate-lines' to t in apropos
	listings, to avoid line-wrapping on overly long descriptions.
	(slime-run-tests): Added the beginnings of an automated test
	suite. (This is most useful for testing cross-Emacsen
	compatibility before releases.)

	* swank.lisp (symbol-external-p): Put back this function which was
	lost in a merge.

2003-09-10  Luke Gorrie  <luke@bluetail.com>

	* slime.el, cmucl-wire.el, swank.lisp: Large patch from Helmut
	Eller. Includes: apropos, describe, compile-defun, fully
	asynchronous continuation-based wire interface, interactive
	evaluation, and more. Very nice :-)

2003-09-08  Luke Gorrie  <luke@bluetail.com>

	* cmucl-wire.el (wire-symbol-name, wire-symbol-package): Fixed to
	handle internal references (pkg::name).

	* slime.el (slime-swank-connection-retries): Increased default
	number of connection retries from 5 to ten.

	* swank.lisp (find-fdefinition): Support for finding
	function/macro definitions for Emacs.

	* slime.el: Indentation "cleanups": somehow I was using
	`common-lisp-indent-function' for Emacs Lisp code previously.
	(slime-edit-fdefinition): Added M-. (edit definition) and M-, (pop
	definition stack) commands. Definitions are found in much the same
	way Hemlock does it. The user-interface is not the same as TAGS,
	because I like this one better. We can add TAGS-compatibility as
	an optional feature in future.

2003-09-04  Luke Gorrie  <luke@bluetail.com>

	* slime.el (slime-completions): Now supports completing
	package-internal symbols with "pkg::prefix" syntax.

	* Everything: imported slime-0.2 sources.

